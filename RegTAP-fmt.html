<?xml version="1.0" encoding="UTF-8"?><!-- this source is meant to be processed with Paul Harrison's
ivoadoc toolkit, see somewhere at http://code.google.com/p/volute/ -->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://www.w3.org/1999/xhtml/vocab">
<title>IVOA Registry Relational Schema IVOA Proposed Recommendation  27 February 2014</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="author" content="Markus Demleitner, gavo@ari.uni-heidelberg.de"/>
<meta name="maintainedBy" content="Markus Demleitner, gavo@ari.uni-heidelberg.de"/>

<link rel="stylesheet" type="text/css" href="http://www.ivoa.net/misc/ivoa_a.css"/>
<link rel="stylesheet" type="text/css" href="http://www.ivoa.net/misc/ivoa_wd.css"/>
<link rel="stylesheet" type="text/css" href="./ivoadoc/XMLPrint.css"/>
<link rel="stylesheet" type="text/css" href="./ivoadoc/ivoa-extras.css"/>

<style type="text/css" xml:space="preserve">

.TODO {
  background-color: #FF0000;
}

div.ignorefornow {
  color: #aaaaaa;
}

code {
  font-weight:normal;
}

.results tr td {
  padding-left: 2px;
  padding-right: 2px;
}

table.results {
  empty-cells: show;
  border-style: none;
  border-spacing: 0px;
}

th.thVertical {
  border-top: 1px solid black;
  border-bottom: 1px solid black;
  padding-top: 4px;
  padding-bottom: 4px;
  margin-bottom: 2px;
  padding-left: 3px;
  padding-right: 3px;
  margin: 0px 0px 0px 0px;
  position: relative;
}

.results td {
  padding-left: 4px;
  padding-right: 40px;
  border-collapse: collapse;
  border:2px solid white;
}

tr.even {
  padding-top:4px;
  padding-bottom:4px;
  background: #EEEEFF;
}

</style>
<link rel="stylesheet" type="text/css" href="http://www.ivoa.net/misc/ivoa_pr.css"/></head>
<body>
<div class="head">
<div id="titlehead" style="position:relative;height:170px;width: 500px">
  <div id="logo" style="position:absolute;width:300px;height:169px;left: 10px;top: 0px;">
    <img src="http://www.ivoa.net/pub/images/IVOA_wb_300.jpg" alt="IVOA logo"/>
  </div>
  <div id="logo-title" style="position:absolute;width:200px;height:115px;left: 300px;top: 5px;">
    <p>
      <b>
        <i>
          <span style="font-size: 14pt; color: #005A9C;"> I</span>
        </i>
      </b>
      <i>
        <span style="font-size: 14pt; color: #005A9C;">nternational</span>
      </i>
    </p>
    <p>
      <b>
        <i>
          <span style="font-size: 14pt; color: #005A9C;padding-left:30px">V</span>
        </i>
      </b>
      <i>
        <span style="font-size: 14pt; color: #005A9C;">irtual</span>
      </i>
    </p>
    <p>
      <b>
        <i>
          <span style="font-size: 14pt; color: #005A9C;padding-left:30px">O</span>
        </i>
      </b>
      <i>
        <span style="font-size: 14pt; color: #005A9C;">bservatory</span>
      </i>
    </p>
    <p>
      <b>
        <i>
          <span style="font-size: 14pt; color: #005A9C;">A</span>
        </i>
      </b>
      <i>
        <span style="font-size: 14pt; color: #005A9C;">lliance</span>
      </i>
    </p>
  </div>
</div>

<h1>IVOA Registry Relational Schema<br/>
Version <span class="docversion">1.0</span></h1>
<h2 class="subtitle">IVOA Proposed Recommendation  27 February 2014</h2>

<dl><dt>Working Group:</dt><dd>
    <a href="http://www.ivoa.net/cgi-bin/twiki/bin/view/IVOA/IvoaResReg" shape="rect">Registry WG</a></dd>
<dt>This version:</dt>
<dd><a class="currentlink" href="http://www.ivoa.net/documents/RegTAP/20140227">http://www.ivoa.net/documents/RegTAP/20140227</a></dd>
<dt><b>Latest version:</b></dt>
      <dd><a href="http://www.ivoa.net/documents/RegTAP/" shape="rect">http://www.ivoa.net/documents/RegTAP/</a></dd>
    <dt>Previous versions:</dt>
      <dd><a href="http://www.ivoa.net/documents/RegTAP/20131203">http://www.ivoa.net/documents/RegTAP/20131203</a></dd>
      <dd><a href="http://www.ivoa.net/documents/RegTAP/20130909">http://www.ivoa.net/documents/RegTAP/20130909</a></dd>
      <dd><a href="http://www.ivoa.net/documents/RegTAP/20130411">http://www.ivoa.net/documents/RegTAP/20130411</a></dd>
      <dd>(Unpublished) Internal Working Draft 2013-03-05 (Volute rev. 2011)</dd>
      <dd>(Unpublished) Internal Working Draft 2012-11-12 (Volute rev. 1864)</dd>
<dt>Authors:</dt>
<dd>
      <a href="http://www.ivoa.net/cgi-bin/twiki/bin/view/IVOA/MarkusDemleitner">Markus Demleitner</a><br/>
      <a href="http://www.ivoa.net/cgi-bin/twiki/bin/view/IVOA/PaulHarrison">Paul Harrison</a><br/>
      <a href="http://www.ivoa.net/cgi-bin/twiki/bin/view/IVOA/MarcoMolinaro">Marco Molinaro</a><br/>
      <a href="http://www.ivoa.net/cgi-bin/twiki/bin/view/IVOA/GretchenGreene">Gretchen Greene</a><br/>
      <a href="http://www.ivoa.net/cgi-bin/twiki/bin/view/IVOA/TheresaDower">Theresa Dower</a><br/>
      <a href="http://wiki.ivoa.net/twiki/bin/view/IVOA/MenelaosPerdikeas">Menelaos Perdikeas</a><br/>
</dd>
</dl>
<hr/>

<h2>Abstract</h2>

<p>Registries provide a mechanism with which VO applications can
discover and select resources—first and foremost data and
services—that are relevant for a particular scientific problem.
This specification defines  an interface for searching this resource
metadata based on the IVOA's TAP protocol.  It specifies a set of tables
that comprise a useful subset of the information contained in the
registry records, as well as the table's data content in terms of the
XML VOResource data model.  The general design of the system is geared
towards allowing easy authoring of queries.</p>

<h2>Status of this Document</h2>

<p id="statusdecl"><em>
                    This is an IVOA Proposed Recommendation made available for
                    public review. It is appropriate to reference this document
                    only as a recommended standard that is under review and
                    which may be changed before it is accepted as a full
                    Recommendation.
                </em></p>

<p><em>A list of</em> <span style="background: transparent">
<a href="http://www.ivoa.net/Documents/" shape="rect"><i>current IVOA
Recommendations and other technical documents</i></a></span><em> can be
found at http://www.ivoa.net/Documents/.</em></p>

<h2 class="prologue-heading-western">Acknowledgments</h2>

<p>This document has been developed in part with support from the German
Astronomical Virtual Observatory (BMBF Bewilligungsnummer 05A08VHA).</p>

<h2 class="prologue-heading-western">Conformance-related definitions</h2>

<p>The words "MUST ", "SHOULD", "MAY", "RECOMMENDED", and "OPTIONAL" (in upper or
lower case) used in this document are to be interpreted as described in the
IETF standard RFC 2119 <cite>[<a href="#std:RFC2119">std:RFC2119</a>]</cite>.</p>


<h2>Contents</h2>
<?toc?><div id="toc" class="toc"><ul><li><a href="#intro"><span class="secnum">1. </span>Introduction</a><ul><li><a href="#terms"><span class="secnum">1.1. </span>Terminology</a></li><li><a href="#rolewithinivoa"><span class="secnum">1.2. </span>The Relational Registry within the VO Architecture</a></li></ul></li><li><a href="#design"><span class="secnum">2. </span>Design Considerations</a></li><li><a href="#primarykeys"><span class="secnum">3. </span>Primary Keys</a></li><li><a href="#stringnorm"><span class="secnum">4. </span>Notes on string normalization</a><ul><li><a href="#whitenorm"><span class="secnum">4.1. </span>Whitespace normalization</a></li><li><a href="#nullnorm"><span class="secnum">4.2. </span>NULL/Empty string normalization</a></li><li><a href="#casenorm"><span class="secnum">4.3. </span>Case normalization</a></li></ul></li><li><a href="#qnameatts"><span class="secnum">5. </span>QNames in VOResource attributes</a></li><li><a href="#vorutypes"><span class="secnum">6. </span>XPaths</a></li><li><a href="#registration"><span class="secnum">7. </span>Discovering Relational Registries</a></li><li><a href="#vortables"><span class="secnum">8. </span>VOResource Tables</a><ul><li><a href="#table_resource"><span class="secnum">8.1. </span>The resource Table</a></li><li><a href="#table_res_role"><span class="secnum">8.2. </span>The res_role Table</a></li><li><a href="#table_res_subject"><span class="secnum">8.3. </span>The res_subject Table</a></li><li><a href="#table_capability"><span class="secnum">8.4. </span>The capability Table</a></li><li><a href="#table_res_schema"><span class="secnum">8.5. </span>The res_schema Table</a></li><li><a href="#table_res_table"><span class="secnum">8.6. </span>The res_table Table</a></li><li><a href="#table_table_column"><span class="secnum">8.7. </span>The table_column Table</a></li><li><a href="#table_interface"><span class="secnum">8.8. </span>The interface Table</a></li><li><a href="#table_intf_param"><span class="secnum">8.9. </span>The intf_param Table</a></li><li><a href="#table_relationship"><span class="secnum">8.10. </span>The relationship Table</a></li><li><a href="#table_validation"><span class="secnum">8.11. </span>The validation Table</a></li><li><a href="#table_res_date"><span class="secnum">8.12. </span>The res_date Table</a></li><li><a href="#table_res_detail"><span class="secnum">8.13. </span>The res_detail Table</a></li></ul></li><li><a href="#adqludf"><span class="secnum">9. </span>ADQL User Defined Functions</a></li><li><a href="#sample_queries"><span class="secnum">10. </span>Common Queries to the Relational Registry</a></li><li><a href="#d_u_list"><span class="secnum">A. </span>XPaths for res_details</a></li><li><a href="#appPGDefs"><span class="secnum">B. </span>The Extra UDFs in PL/pgSQL</a></li><li><a href="#appBP"><span class="secnum">C. </span>Implementation notes</a></li><li><a href="#appMkut"><span class="secnum">D. </span>XSLT to enumerate Relational Registry XPaths</a></li><li><a href="#changes"><span class="secnum">E. </span>Changes from Previous Versions</a><ul><li><a href="#changes-20140227"><span class="secnum">E.1. </span>Changes from PR-20140227</a></li><li><a href="#changes-20131203"><span class="secnum">E.2. </span>Changes from WD-20131203</a></li><li><a href="#changes-20130909"><span class="secnum">E.3. </span>Changes from WD-20130909</a></li><li><a href="#changes-20130411"><span class="secnum">E.4. </span>Changes from WD-20130411</a></li><li><a href="#changes-20130305"><span class="secnum">E.5. </span>Changes from WD-20130305</a></li><li><a href="#changes-20121112"><span class="secnum">E.6. </span>Changes from WD-20121112</a></li></ul></li><li><a href="#references"><span class="secnum"/>References</a></li></ul></div>

</div><!-- class="head" -->

<div class="body">

<div class="section"><h2><a id="intro"><span class="secnum">1. </span>Introduction</a></h2>

<p>In the Virtual Observatory (VO), registries provide a means for
discovering useful resources, i.e., data and services.  Individual
publishers offer the descriptions for their resources ("resource
records") in publishing registries.  At the time of writing, there are
roughly 14000 such resource records active within the VO, originating
from about 20 publishing registries.</p>

<p>The protocol spoken by these
publishing registries, OAI-PMH only allows restricting queries by
modification date and identifier and is hence not suitable for data discovery.
Even if it were, data discovery would at least be fairly time consuming if
each client had to query dozens or, potentially, hundreds of
publishing registries.</p>

<p>To enable efficient data discovery nevertheless, there are services harvesting the
resource records from the publishing registries and offering rich query
languages.
The IVOA Registry
Interfaces specification <cite>[<a href="#std:RI1">std:RI1</a>]</cite> defined, among other aspects of
the VO registry system, such an interface
using SOAP and an early draft of an XML-based query language.</p>

<p>This document provides an update to the query ("searchable registry") part
of that specifiation (chapter 2), aimed towards
usage with current VO standards, in particular TAP <cite>[<a href="#std:TAP">std:TAP</a>]</cite>
and ADQL <cite>[<a href="#std:ADQL">std:ADQL</a>]</cite>.  It follows the model of ObsCore
<cite>[<a href="#std:OBSCORE">std:OBSCORE</a>]</cite> of defining a representation of a data model
within a relational database.  In this case, the data model is a
simplification of the VO's resource metadata interchange representation,
the VOResource XML format <cite>[<a href="#std:VOR">std:VOR</a>]</cite>.  The simplification
yields 13 tables.  For each table, TAP_SCHEMA metadata is given together
with rules for how to fill these tables from VOResource-serialized
metadata records as well as conditions on foreign keys and
recommendations on indices.</p>

<p>The resulting set of tables has a modest size by today's standards,
but is still non-trivial.  The largest table, <code>table_column</code>,
has about half a million rows at the time of writing.</p>

<p>The architecture laid out here allows client applications to perform "canned"
queries on behalf of their users as well as complex queries formulated
directly by advanced users, using the same TAP clients they employ to
query astronomical data servers.</p>

<div class="section"><h3><a id="terms"><span class="secnum">1.1. </span>Terminology</a></h3>

<p>The set of tables and their metadata specified here, together with
the mapping from VOResource ("ingestion rules") is collectively
called "relational registry schema" or relational registry for
short.</p>

<p>The specificiation additionally talks about how to embed these into TAP
services, gives additional user defined functions, talks about
discovering compliant services, etc.  Since all this is tightly coupled
to the "relational registry" as defined above, we do not 
introduce a new term for it.  Hence, the entire standard is now known as
"IVOA registry relational schema".</p>

<p>Historically, we intended to follow the ObsCore/ObsTAP model and
talked about RegTAP.  As changing this acronym is technically painful
(e.g., identifiers and URLs would need to be adapted), we kept it after
the distinction between the schema and its mapping on the one hand and
the its combination with a TAP service on the other went away.  This
means that the official acronym for "IVOA registry relational schema" is
RegTAP.  This aesthetic defect seems preferable to causing actual
incompatibilities.</p>

</div> <!-- subsection terms -->

<div class="section"><h3><a id="rolewithinivoa"><span class="secnum">1.2. </span>The Relational Registry within the VO Architecture</a></h3>

<div class="figure">
<img src="RegTAP-arch.png" alt="The Relational Registry within the VO architecture" align="middle"/>
<p class="figurecaption"><strong>Figure 1:</strong> IVOA Architecture
diagram with the IVOA Registry Relational Specification (tagged with "Relational Registry") and
the related standards marked up.</p>
</div>

<p>This specification directly relates to other VO standards in the
following ways:</p>

<dl>
<dt>VOResource, v1.03 <cite>[<a href="#std:VOR">std:VOR</a>]</cite></dt>
<dd>VOResource sets the foundation for a formal definition of the data
model for resource records via its schema definition.  This document
refers to concepts laid down there via XPaths <cite>[<a href="#std:XPATH">std:XPATH</a>]</cite>.</dd>


<dt>VODataService, v1.1 <cite>[<a href="#std:VODS11">std:VODS11</a>]</cite></dt>
<dd>VODataService extends the VOResource data model by important
concepts and resource types (tablesets, data services, data
collections).  These concepts and types are reflected in the database
schema.  Again xpaths link this specification and VODataService.</dd>

<dt>Other Registry Extensions</dt>
<dd>Registry extensions are VO standards
defining how particular resources (e.g., Standards) or capabilities
(e.g., IVOA defined interfaces) are described.  Most aspects
introduced by them are reflected in the <code>res_detail</code> table using
xpaths into the registry documents.
This document should not in general need updates
for registry extension updates.  For completeness, we note the
versions current as of this specification: SimpleDALRegExt 1.0
<cite>[<a href="#std:DALREGEXT">std:DALREGEXT</a>]</cite>,
StandardsRegExt 1.0 <cite>[<a href="#std:STDREGEXT">std:STDREGEXT</a>]</cite>, TAPRegExt 1.0
<cite>[<a href="#std:TAPREGEXT">std:TAPREGEXT</a>]</cite>, Registry Interfaces 1.0 <cite>[<a href="#std:RI1">std:RI1</a>]</cite>.</dd>

<dt>TAP, v1.0 <cite>[<a href="#std:TAP">std:TAP</a>]</cite></dt>
<dd>The queries against the schema defined in the present document, and the results of
these queries, will usually be transported using the Table Access
Protocol TAP.  It also allows discovering
local additions to the registry relations via TAP's metadata publishing
mechanisms.</dd>

<dt>IVOA Identifiers, v1.12 <cite>[<a href="#std:VOID">std:VOID</a>]</cite> </dt>
<dd>IVOA identifiers are something like the primary keys within the VO
registry; as such, they are actual primary keys of the central table of
the relational registry. Also, the notion of an authority as laid down
in IVOA Identifiers plays an important role as publishing registries can
be viewed as a realization of a set of authorities.</dd> </dl>

<p>This standard also relates to other IVOA standards:</p>

<dl>
<dt>ADQL, v2.0 <cite>[<a href="#std:ADQL">std:ADQL</a>]</cite></dt>
<dd>The rules for ingestion are designed to allow
easy queries given the constraints of ADQL 2.0.  Also,
we give three functions that extend ADQL using the
language's built-in facility for user-defined functions.</dd>

<dt>RegTAP-STC</dt>
<dd>This specification will be complemented by a schema of four tables, also
under the <code>rr</code> schema making up the relational registry, that gives coverages of resources on the spatial,
temporal, spectral and redshift axes.  These will be defined in a
separate document.</dd>
</dl>

</div> <!-- subsection rolewithinivoa -->
</div> <!-- section introduction -->



<div class="section"><h2><a id="design"><span class="secnum">2. </span>Design Considerations</a></h2>

<p>In the design of the tables, the goal has been to preserve as much of
VOResource and its extensions, including the element names, as
possible.</p>

<p>An overriding consideration has been, however, to make natural joins
between the tables behave usefully, i.e., to actually combine rows
relevant to the same entity (resource, table, capability, etc.).
To disambiguate column names that name the same concept on different
entities (name, description, etc.) and would therefore interfere with
the natural join, a shortened tag for the source object
is prepended to the name.  Thus, a <code>description</code> element within
a resource ends up in a column named
<code>res_description</code>, whereas the same element from a
capability becomes <code>cap_description</code>.</p>

<p>We further renamed some columns and most tables 
with respect to their VOResource
counterparts to avoid clashes with reserved words in popular database
management systems.  The alternatives would have been to either recommend
quoting them or burden ADQL translation layers with the task of
automatically converting them to delimited identifiers.  Both
alternatives seemed either confusing or impacting robustness.</p>

<p>Furthermore, camel-case identifiers have been converted to
underscore-separated ones (thus, <code>standardId</code>  becomes
<code>standard_id</code>) to have all-lowercase column names; this saves
potential headache if users choose to reference the columns using SQL
delimited identifiers.  Dashes in VOResource attribute names are
converted to underscores, too, with the exception of
<code>ivo-id</code>, which is just rendered <code>ivoid</code>.</p>

<p>Another design goal of this specification has been that different registries
operating on the same set of registry records will return identical responses
for most queries; hence, we try to avoid relying on features left not
defined by ADQL (e.g., the case sensitivity of string matches).  However,
with a view to non-uniform support for information retrieval-type
queries in database systems, the <code>ivo_hasword</code> user defined
function is not fully specified here; queries employing it may yield
different results on different implementations, even if they operate on
the same set of resource records.</p>


</div>  <!-- subsection design -->

<div class="section"><h2><a id="primarykeys"><span class="secnum">3. </span>Primary Keys</a></h2>

<p>The primary key in the Registry as an abstract concept is a resource
record's IVORN.  Hence, for all tables having primary keys at all, the
<code>ivoid</code> column is part of its primary key.  This
specification does not require implementations to actually declare
primary keys in the underlying database, and no aspect of user-visible
behavior depends on such explicit declarations; in particular, this
specification makes no requirements on the contents of
<code>tap_schema.keys</code>.</p>

<p>We nevertheless make recommendations on explicit primary keys, as
we expect definitions according to our recommendations will enhance
robustness of services.</p>

<p>In several RegTAP tables—<code>capability</code>,
<code>res_schema</code>, <code>res_table</code>, and
<code>interface</code>—artificial primary keys are necessary, as
in VOResource XML sibling elements are not otherwise distinguished.  To
allow such artificial primary keys, a column is added to each table, the
name of which ends in <code>_index</code> (<code>cap_index</code>,
<code>schema_index</code>, <code>table_index</code>, and
<code>intf_index</code>).</p>

<p>The type and content of these <code>X_index</code> columns is
implementation-defined, and clients must not make assumptions on their
content except that the pair <code>ivoid, X_index</code> is a primary
key for the relation (plus, of course, that references from other tables
correctly resolve).  In the tables of columns given below, the
<code>X_index</code> columns have "(key)" given for type.  Implementors
obviously have to insert whatever ADQL type is appropriate for their
choice or <code>X_index</code> implementation.</p>

<p>Obvious implementations for <code>X_index</code> include having
<code>X_index</code> enumerate the sibling elements or using some sort
of UUID.</p>

</div>


<div class="section"><h2><a id="stringnorm"><span class="secnum">4. </span>Notes on string normalization</a></h2>

<p>In the interest of consistent behavior between different RegTAP
implementations regardless of their technology choices, this section
establishes some rules on the treatment of strings—both those
obtained from attributes and those obtained from element
content—during ingestion from VOResource XML to database
tables.</p>

<div class="section"><h3><a id="whitenorm"><span class="secnum">4.1. </span>Whitespace normalization</a></h3>

<p>Most string-valued items in VOResource and extensions are of type
<code>xs:token</code>, with the clear intent that whitespace in them is
to be normalized in the sense of XML schema.  For the few exceptions
that actually are directly derived from xs:string (e.g.,
<code>vstd:EndorsedVersion</code>, <code>vs:Waveband</code>) it does not
appear that the intent regarding whitespace is different.</p>

<p>In order to provide reliable querying and simple rules for ingestors
even when these do not employ schema-aware XML parsers, this standard
requires that during ingestion, leading and trailing whitespace MUST be
removed from all strings; in particular, there are no strings consisting
exclusively of whitespace in RegTAP.  The treatment of internal
whitespace is implementation-defined. This reflects the expectation
that, whereever multi-word items are queried, whitespace-ignoring
constraints will be used (e.g., LIKE-based regular expressions or the
<code>ivo_hasword</code> user defined function defined below).</p>
</div> <!-- subsection whitenorm -->

<div class="section"><h3><a id="nullnorm"><span class="secnum">4.2. </span>NULL/Empty string normalization</a></h3>

<p>While empty strings and NULL values are not usually well
distinguished in VO practice—as reflected in the conventional
TABLEDATA and BINARY serializations of VOTable—, the distinction
must be strictly maintained in the database tables to ensure
reproduceable queries across different RegTAP implementations.</p>

<p>Ingestors therefore MUST turn empty strings (which, by section <span class="xref"><a href="#whitenorm">4.1</a></span>, include strings consisting of whitespace
only in VOResource's XML serialization) into NULL values in the
database.  Clients expressing constraints on the presence (or absence)
of some information must therefore do so using SQL's <code>IS NOT NULL</code>
(or <code>IS NULL</code>) operators.</p>
</div> <!-- subsection nullnorm -->

<div class="section"><h3><a id="casenorm"><span class="secnum">4.3. </span>Case normalization</a></h3>
<p>ADQL has no operators for case-insensitive matching of strings.  To
allow for robust and straightforward queries nevertheless, most columns
containing values not usually intended for display are required to be
converted to lower case; in the table descriptions below, there are
explicit requirements on case normalization near the end of each
section.  This is particularly important when the entities to be
compared are defined to be case-insensitive (e.g., UCDs, IVORNs).
Client software that can inspect user-provided arguments (e.g., when
filling template queries) should also convert the respective fields to
lower case.</p>

<p>This conversion MUST cover all ASCII letters, i.e., A through Z.  
The conversion SHOULD take place according to
algorithm R2 in section 3.13, "Default Case Algorithms" of 
<cite>[<a href="#std:UNICODE">std:UNICODE</a>]</cite>.  In practice, non-ASCII characters are not expected
to occur in columns for which lowercasing is required.</p>

<p>Analogously, case-insensitive comparisons as required by some of the
user-defined functions for the relational registry MUST compare
the ASCII letters without regard for case.  They SHOULD compare according
to D144 in <cite>[<a href="#std:UNICODE">std:UNICODE</a>]</cite>.</p>

</div> <!-- subsection casenorm -->
</div> <!-- section stringnorm -->


<div class="section"><h2><a id="qnameatts"><span class="secnum">5. </span>QNames in VOResource attributes</a></h2>
<p>VOResource and its extensions make use of XML QNames in attribute
values, most prominently in <code>xsi:type</code>.  The standard
representation of these QNames in XML instance documents makes use of an
abbreviated notation employing prefixes declared using the xmlns mechanism
as discussed in <cite>[<a href="#std:XMLNS">std:XMLNS</a>]</cite>.  Within an ADQL-exposed database, no
standard mechanism exists that could provide a similar mapping of URLs
and abbreviations.  The correct way to handle this problem would thus be
to have full QNames in the database (e.g.,
<code>{http://www.ivoa.net/xml/ConeSearch/v1.0}ConeSearch</code> for the
canonical <code>cs:ConeSearch</code>).  This, of course, would make for
excessively tedious and error-prone querying.</p>

<p>For various reasons, VOResource authors have always been encouraged
to use a set of "standard" prefixes.  This allows an easy and, to users,
unsurprising exit from the problem of the missing xmlns declarations:
For the representation of QNames within the database, these recommended
prefixes are now mandatory. Future VOResource extensions define their
mandatory prefixes themselves.</p>  

<p>Following the existing practice, minor version changes are not in
general reflected in the recommended prefixes—e.g., both VODataService
1.0 and VODataService 1.1 use <code>vs:</code>.  For reference, here is
a table of XML namespaces and prefixes for namespaces relevant to this
specification:</p>

<table>
<tr><td>cs</td><td>http://www.ivoa.net/xml/ConeSearch/v1.0</td></tr>
<tr><td>dc</td><td>http://purl.org/dc/elements/1.1/</td></tr>
<tr><td>oai</td><td>http://www.openarchives.org/OAI/2.0/</td></tr>
<tr><td>ri</td><td>http://www.ivoa.net/xml/RegistryInterface/v1.0</td></tr>
<tr><td>slap</td><td>http://www.ivoa.net/xml/SLAP/v1.0</td></tr>
<tr><td>sia</td><td>http://www.ivoa.net/xml/SIA/v1.0</td></tr>
<tr><td>sia</td><td>http://www.ivoa.net/xml/SIA/v1.1</td></tr>
<tr><td>ssap</td><td>http://www.ivoa.net/xml/SSA/v1.0</td></tr>
<tr><td>ssap</td><td>http://www.ivoa.net/xml/SSA/v1.1</td></tr>
<tr><td>tr</td><td>http://www.ivoa.net/xml/TAPRegExt/v1.0</td></tr>
<tr><td>vg</td><td>http://www.ivoa.net/xml/VORegistry/v1.0</td></tr>
<tr><td>vr</td><td>http://www.ivoa.net/xml/VOResource/v1.0</td></tr>
<tr><td>vs</td><td>http://www.ivoa.net/xml/VODataService/v1.0</td></tr>
<tr><td>vs</td><td>http://www.ivoa.net/xml/VODataService/v1.1</td></tr>
<tr><td>vstd</td><td>http://www.ivoa.net/xml/StandardsRegExt/v1.0</td></tr>
<tr><td>xsi</td><td>http://www.w3.org/2001/XMLSchema-instance</td></tr>
</table>
</div>

<div class="section"><h2><a id="vorutypes"><span class="secnum">6. </span>XPaths</a></h2>

<p>This specification piggybacks on top of the well-established
VOResource standard.  This means that it does not define a full data model,
but rather something like a reasonably query-friendly view of a partial
representation of one.  The link between the actual data model, i.e.,
VOResource and its extensions as defined by the XML Schema documents, and
the fields within this database schema, is provided by
xpaths, which are here slightly abbreviated for both brevity and
generality.</p>

<p>All xpaths given in this specifiation are assumed to be relative to
the enclosing <code>vr:Resource</code> element; these are called
"resource xpaths" in the following.  If resource xpaths are to be
applied to an OAI-PMH response, the xpath expression
<code>*/*/*/oai:metadata/ri:Resource</code> must be prepended to it,
with the canonical prefixes from section <span class="xref"><a href="#qnameatts">5</a></span> implied.  The resource xpaths themselves
largely do not need explicit namespaces since VOResource elements are by
default unqualified.  Elements and attributes from non-VOResource
schemata have the canonical namespace prefixes, which in this
specification only applies to several <code>xsi:type</code> attribute
names.</p>

<p>Some tables draw data from several different VOResource elements.
For those, we have introduced an extended syntax with additional
metacharacters (, ), and |, where the vertical bar denotes an
alternative and the parentheses grouping.  For instance, our notation
<code>/(tableset/schema/|)table/</code> corresponds to the two xpaths
<code>/table</code> and <code>/tableset/schema/table</code>.</p>

<p>Within the Virtual Observatory, the link between data models and
concrete data representations is usually made using utypes.
Since VOResource is directly modelled
in XML Schema, the choice of XPath as the bridging formalism is 
compelling, though, and utypes themselves are not necessary for the
operation of a TAP service containing the relational registry.
TAP, however, offers fields for utypes in its TAP_SCHEMA.  Since they
are not otherwise required, this specification takes the liberty of
using them to denote the xpaths.</p>

<p>In the metadata for tables and columns below, the utypes given are
obtained from the xpaths by simply prepending them with
<code>xpath:</code>.  To avoid repetition, we allow relative xpaths:
when the xpath in a column utype does not start with a slash, it is
understood that is must be concatenated with the table utype to obtain
the full xpath.</p>

<p>For illustration, if a table has a utype of
<code>xpath:/capability/interface/</code> and a column within this table
has a utype of <code>xpath:accessURL/@use</code>, the resulting resource
xpath would come out to be
<code>/capability/interface/accessURL/@use</code>; to match this in an
OAI-PMH response, the xpath would be
<code>*/*/*/oai:metadata/ri:Resource/capability/interface/accessURL/@use</code>.
</p>

<p>While clients MUST NOT rely on these utypes in either TAP_SCHEMA or the
metadata delievered with TAP replies, service operators SHOULD provide them, in
particular when there are local extensions to the relational registry in their
services.  Giving xpaths for extra columns and tables helps human
interpretation of them at least when the defining schema files are
available.</p>

<p>Resource xpaths are also used in the res_details table (section <span class="xref"><a href="#table_res_detail">8.13</a></span>).  These are normal xpaths
(although again understood relative to the enclosing Resource element),
which, in particular, means that they are case sensitive.  On the other
hand, to clients they are simply opaque strings, i.e., clients cannot
just search for any xpaths into VOResource within res_details.</p>

</div><!-- subsection vorutypes -->

<div class="section"><h2><a id="registration"><span class="secnum">7. </span>Discovering Relational Registries</a></h2>

<p>The relational registry can be part of any TAP service.  The presence
of the tables discussed here is indicated by declaring support for the
data model <code>Registry 1.0</code> with the IVORN
<code>ivo://ivoa.net/std/RegTAP#1.0</code> in the service's
capabilities (see <cite>[<a href="#std:TAPREGEXT">std:TAPREGEXT</a>]</cite>).  Technically, this
entails adding</p>

<pre>
&lt;dataModel ivo-id="ivo://ivoa.net/std/RegTAP#1.0"
  &gt;Registry 1.0&lt;/dataModel&gt;
</pre>

<p>as a child of the capability element with the type
<code>{http://www.ivoa.net/xml/TAPRegExt/v1.0}TableAccess</code>.</p>

<p>A client that knows the access URL of one TAP service containing 
a relational
registry can thus discover all other services exposing one. The <a href="#example-findregtap">"Find all TAP endpoints offering the
relational registry"</a> example in section
<span class="xref"><a href="#sample_queries">10</a></span> shows a query that does
this.</p>

<p>It is recommended to additionally register a relational registry as a
VODataService data collection and connect this and the TAP services
with a pair of service-for/served-by relations.  This allows giving more
metadata on the data content like, for example, the frequency of
harvesting.</p>

<p>Services implementing this data model that do not (strive to) offer
the full data content of the VO registry (like domain-specific
registries or experimental systems) MUST NOT declare the above data
model in order to not invite clients expecting the VO registry to send
queries to it.</p>

</div><!-- subsection registration -->

<div class="section"><h2><a id="vortables"><span class="secnum">8. </span>VOResource Tables</a></h2>

<p>In the following table descriptions, the names of tables and columns
are normative and MUST be used as given, and all-lowercase.  On the
values in the <code>utype</code> columns within <code>TAP_SCHEMA</code>,
see section <span class="xref"><a href="#vorutypes">6</a></span>.  All columns defined in
this document MUST have a 1 in the <code>std</code> column of the
<code>TAP_SCHEMA.table_columns</code> table.  Unless otherwise
specified, all values of ucd and unit in
<code>TAP_SCHEMA.table_columns</code> are NULL for columns defined here.
Descriptions are not normative (as given, they usually are taken from
the schema files of VOResource and its extensions with slight
redaction).  Registry operators MAY provide additional columns in their
tables, but they MUST provide all columns given in this
specification.</p>

<p>All table descriptions start out with brief remarks on the
relationship of the table to the VOResource XML data model.  Then, the
columns are described in a selection of TAP_SCHEMA metadata. For each
table, recommendations on explicit primary and foreign keys as well as
indexed columns are given, where it is understood that primary and
foreign keys are already indexed in order to allow efficient joins;
these parts are not normative, but operators should ensure decent
performance for queries assuming the presence of the given indices and
relationships.  Finally, lowercasing requirements
(normative) are given.</p>


<p>The following tables make up the data model
<code>ivo://ivoa.net/std/RegTAP#1.0</code>:</p>

<!-- GENERATED: gettables.sh -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Table<br/>Utype</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td><a href="#table_capability">rr.capability</a><br/>xpath:/capability/</td><td> Pieces of behaviour of a resource.</td></tr>
<tr class="data even"><td><a href="#table_interface">rr.interface</a><br/>xpath:/capability/interface/</td><td> Information on access modes of a capability.</td></tr>
<tr class="data"><td><a href="#table_intf_param">rr.intf_param</a><br/>xpath:/capability/interface/param/</td><td> Input parameters for services.</td></tr>
<tr class="data even"><td><a href="#table_relationship">rr.relationship</a><br/>xpath:/content/relationship/</td><td> Relationships between resources, e.g., mirroring, derivation, but
also providing access to data within a resource.</td></tr>
<tr class="data"><td><a href="#table_res_date">rr.res_date</a><br/>xpath:/curation/</td><td> A date associated with an event in the life cycle of the resource.
This could be creation or update. The role column can be used to
clarify.</td></tr>
<tr class="data even"><td><a href="#table_res_detail">rr.res_detail</a><br/>N/A</td><td> XPath-value pairs for members of resource or capability and their
derivations that are less used and/or from VOResource extensions. The
pairs refer to a resource if cap_index is NULL, to the referenced
capability otherwise.</td></tr>
<tr class="data"><td><a href="#table_res_role">rr.res_role</a><br/>N/A</td><td> Entities, i.e., persons or organizations, operating on resources:
creators, contacts, publishers, contributors.</td></tr>
<tr class="data even"><td><a href="#table_res_schema">rr.res_schema</a><br/>xpath:/tableset/schema/</td><td> Sets of tables related to resources.</td></tr>
<tr class="data"><td><a href="#table_res_subject">rr.res_subject</a><br/>xpath:/content/</td><td> Topics, object types, or other descriptive keywords about the
resource.</td></tr>
<tr class="data even"><td><a href="#table_res_table">rr.res_table</a><br/>xpath:/(tableset/schema/|)table/</td><td> (Relational) tables that are part of schemata or resources.</td></tr>
<tr class="data"><td><a href="#table_resource">rr.resource</a><br/>xpath:/</td><td> The resources, i.e., services, data collections, organizations, etc.,
present in this registry.</td></tr>
<tr class="data even"><td><a href="#table_table_column">rr.table_column</a><br/>xpath:/(tableset/schema/|)/table/column/</td><td> Metadata on columns of tables pertaining to resources.</td></tr>
<tr class="data"><td><a href="#table_validation">rr.validation</a><br/>xpath:/(capability|)</td><td>Validation levels for resources and capabilities.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<div class="section"><h3><a id="table_resource"><span class="secnum">8.1. </span>The resource Table</a></h3>

<p>The <code>rr.resource</code> table contains most atomic members of
<code>vr:Resource</code> that have a 1:1 relationship to the resource
itself.  Members of derived types are, in general, handled through 
the <code>res_detail</code>
table even if 1:1 (see <span class="xref"><a href="#table_res_detail">8.13</a></span>).  The
content_level, content_type, waveband, and rights members are 1:n but still appear
here.  If there are multiple values, they are concatenated with hash
characters (#).  Use the <code>ivo_hashlist_has</code> ADQL extension
function to check for the presence of a single value.  This convention
saves on tables while not complicating common queries significantly.</p>

<p>A local addition is the <code>creator_seq</code> column.  It contains
all content of the <code>name</code> elements below a resource element
<code>curation</code> child's <code>creator</code> children,
concatenated with a sequence of semicolon and blank characters (<code>";
"</code>). The individual parts must be concatenated preserving the
sequence of the XML elements.  The resulting string is primarily intended
for display purposes ("author list") and is hence not case-normalized.
It was added since the equivalent of an author list is expected to be
a metadatum that is displayed fairly frequently, but also since the
sequence of author names is generally considered significant.  The
<code>res_role</code> table, on the other hand, does not allow
recovering the input sequence of the rows belonging to one resource.</p>

<p>The <code>res_type</code> column reflects the lower-cased value of
the <code>ri:Resource</code> element's <code>xsi:type</code> attribute,
where the canonical prefixes are used.  While custom or experimental
VOResource extensions may lead to more or less arbitrary strings in that
column, VOResource and its IVOA-recommended extensions at the time of
writing define the following values for <code>res_type</code>:</p>

<dl>
<dt>vg:authority</dt>
<dd>A naming authority (these records allow resolving who is responsible
for IVORNs with a certain authority; cf. <cite>[<a href="#std:VOID">std:VOID</a>]</cite>)</dd>
<dt>vg:registry</dt>
<dd>A registry is considered a publishing registry if it contains a
capability element with <code>xsi:type="vg:Harvest"</code>.  Old,
RegistryInterface 1-compliant registries also use this type with a
capability of type <code>vg:Search</code>.  The relational registry as
specified here, while superceding these old <code>vg:Search</code>
capabilities, does <em>not</em> use this type any more.  See section
<span class="xref"><a href="#registration">7</a></span> on how to locate services
supporting it.</dd>
<dt>vr:organisation</dt>
<dd>The main purpose of an organisation as a registered resource is to
serve as a publisher of other resources.</dd>
<dt>vr:resource</dt>
<dd>Any entity or component of a VO application that is describable and
identifiable by a IVOA Identifier; while it is technically possible to
publish such records, the authors of such records should probably be
asked to use a more specific type.</dd>
<dt>vr:service</dt>
<dd>A resource that can be invoked by a client to perform some action on
its behalf</dd>
<dt>vs:catalogservice</dt>
<dd>A service that interacts with one or more specified tables having
some coverage of the sky, time, and/or frequency.</dd>
<dt>vs:dataservice</dt>
<dd>A service for accessing astronomical data; publishers choosing
this over <code>vs:catalogservice</code> probably intend to communicate
that there are no actual sky positions in the tables exposed.</dd>
<dt>vs:datacollection</dt>
<dd>A schema as a logical grouping of data which, in general, is
composed of one or more accessible datasets.  Use the
<code>rr.relationship</code> table to find out services that allow
access to the data (the <code>served_by</code> relation), and/or look for values for
<code>/accessURL</code> in
<a href="#table_res_detail">rr.res_detail</a>.</dd>
<dt>vstd:standard</dt>
<dd>A description of a standard specification.</dd>
</dl>

<p>The <code>status</code> attribute of <code>vr:Resource</code> is
considered an implementation detail of the XML serialization and is not
kept here.  Neither <code>inactive</code> nor <code>deleted</code>
records may be kept in the <code>resource</code> table.  Since all
other tables in the relational registry should keep a foreign key on the
<code>ivoid</code> column, this implies that only metadata on
<code>active</code> records 
is being kept in the relational registry. In other words, users can
expect a resource to exist and work if they find it in a relational 
registry .</p>


<!-- GENERATED: maketable.sh rr.resource -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:identifier</td><td>adql:VARCHAR(*)</td><td>Unambiguous reference to the resource conforming to the IVOA standard for identifiers</td></tr>
<tr class="data even"><td>res_type <br/>xpath:@xsi:type</td><td>adql:VARCHAR(*)</td><td>Resource type (something like vs:datacollection, vs:catalogservice, etc)</td></tr>
<tr class="data"><td>created <br/>xpath:@created</td><td>adql:TIMESTAMP</td><td>The UTC date and time this resource metadata description was created. This timestamp must not be in the future. This time is not required to be accurate; it should be at least accurate to the day. Any insignificant time fields should be set to zero.</td></tr>
<tr class="data even"><td>short_name <br/>xpath:shortName</td><td>adql:VARCHAR(*)</td><td>A short name or abbreviation given to something. This name will be used where brief annotations for the resource name are required. Applications may use it to refer to the resource in a compact display. One word or a few letters is recommended. No more than sixteen characters are allowed.</td></tr>
<tr class="data"><td>res_title <br/>xpath:title</td><td>adql:VARCHAR(*)</td><td>The full name given to the resource</td></tr>
<tr class="data even"><td>updated <br/>xpath:@updated</td><td>adql:TIMESTAMP</td><td>The UTC date this resource metadata description was last updated. This timestamp must not be in the future. This time is not required to be accurate; it should be at least accurate to the day. Any insignificant time fields should be set to zero.</td></tr>
<tr class="data"><td>content_level <br/>xpath:content/contentLevel</td><td>adql:VARCHAR(*)</td><td>A hash-separated list of content levels specifying the intended audience</td></tr>
<tr class="data even"><td>res_description <br/>xpath:content/description</td><td>adql:VARCHAR(*)</td><td>An account of the nature of the resource.</td></tr>
<tr class="data"><td>reference_url <br/>xpath:content/referenceURL</td><td>adql:VARCHAR(*)</td><td>URL pointing to a human-readable document describing this resource.</td></tr>
<tr class="data even"><td>creator_seq <br/>xpath:curation/creator/name</td><td>adql:VARCHAR(*)</td><td>The creator(s) of the resource in the order given by the resource record author, separated by semicolons.</td></tr>
<tr class="data"><td>content_type <br/>xpath:content/type</td><td>adql:VARCHAR(*)</td><td>A hash-separated list of natures or genres of the content of the resource</td></tr>
<tr class="data even"><td>source_format <br/>xpath:content/source/@format</td><td>adql:VARCHAR(*)</td><td>The format of source_value. Recognized values include "bibcode", referring to a standard astronomical bibcode (http://cdsweb.u-strasbg.fr/simbad/refcode.html).</td></tr>
<tr class="data"><td>source_value <br/>xpath:content/source</td><td>adql:VARCHAR(*)</td><td>A bibliographic reference from which the present resource is derived or extracted.</td></tr>
<tr class="data even"><td>res_version <br/>xpath:curation/version</td><td>adql:VARCHAR(*)</td><td>Label associated with creation or availablilty of a version of a resource.</td></tr>
<tr class="data"><td>region_of_regard <br/>xpath:coverage/regionOfRegard</td><td>adql:REAL</td><td>A single numeric value representing the angle, given in decimal degrees, by which a positional query against this resource should be "blurred" in order to get an appropriate match.</td></tr>
<tr class="data even"><td>waveband <br/>xpath:coverage/waveband</td><td>adql:VARCHAR(*)</td><td>A hash-separated list of regions of the electro-magnetic spectrum that the resource's spectral coverage overlaps with.</td></tr>
<tr class="data"><td>rights <br/>xpath:rights</td><td>adql:VARCHAR(*)</td><td>Information about rights held in and over the resource (multiple values are separated by hashes).</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>This table should have the <code>ivoid</code> column explicitly set
as its primary key.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>res_type</code>, <code>content_level</code>,
<code>content_type</code>, <code>source_format</code>,
<code>waveband</code>.
Clients are advised to query the <code>res_description</code> and
<code>res_title</code>  columns
using the the <code>ivo_hasword</code> function, and to use
<code>ivo_hashlist_has</code> on <code>content_level</code>,
<code>content_type</code>,
<code>waveband</code>, and <code>rights</code>.</p>

<p>The row for <code>region_of_regard</code> 
<code>TAP_SCHEMA.tables</code> must have <code>deg</code> in its
<code>unit</code> column.</p>

</div> <!-- subsection table_resource -->

<div class="section"><h3><a id="table_res_role"><span class="secnum">8.2. </span>The res_role Table</a></h3>

<p>This table subsumes the contact, publisher, contributor, 
and creator members of the
VOResource data model.  They have been combined into a single table to
reduce the total number of tables, and also in anticipation of a unified
data model for such entities in future versions of VOResource.</p>

<p>The actual role is given in the <code>base_role</code> column, which
can be one of <code>contact</code>, <code>publisher</code>, <code>contributor</code>, or
<code>creator</code>.  Depending on this value, here are the xpaths
for the table fields (we have abbreviated
<code>/curation/publisher</code>
as cp, <code>/curation/contact</code> as co, <code>/curation/creator</code> 
as cc,
and <code>/curation/contributor</code> as cb):</p>

<table class="results" frame="box" rules="rows">
<tr><th>base_role value</th>
<th>contact</th>
<th>publisher</th>
<th>creator</th>
<th>contributor</th>
</tr>

<tr>
<td>role_name</td>
<td>co/name</td>
<td>cp</td>
<td>cc/name</td>
<td>cb</td>
</tr>

<tr>
<td>role_ivoid</td>
<td>co/name/@ivo-id</td>
<td>cp/@ivo-id</td>
<td>cc/name/@ivo-id</td>
<td>cb/@ivo-id</td>
</tr>

<tr>
<td>address</td>
<td>co/address</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>

<tr>
<td>email</td>
<td>co/email</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>

<tr>
<td>telephone</td>
<td>co/telephone</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>

<tr>
<td>logo</td>
<td>co/logo</td>
<td>N/A</td>
<td>cc/logo</td>
<td>N/A</td>
</tr>

</table>

<p>Not all columns are available for each role type in VOResource.  For
example, contacts have no logo, and creators no telephone members.  Unavailable
metadata (marked with N/A in the above table) MUST be represented with NULL
values in the corresponding columns.</p>

<p>Note that, due to current practice in the VO, it is not easy to
predict what <code>role_name</code> will contain; it could be a single
name, where again the actual format is unpredictable
(full first name, initials in front or behind, or
even a project name), but it could as well be a full author list.  Thus,
when matching against <code>role_names</code>, you will have to use
rather lenient regular expressions.  Changing this, admittedly
regrettable, situation would
probably require a change in the VOResource schema.</p>

<!-- GENERATED: maketable.sh rr.res_role -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>role_name <br/>N/A</td><td>adql:VARCHAR(*)</td><td>The real-world name or title of a person or organization</td></tr>
<tr class="data"><td>role_ivoid <br/>N/A</td><td>adql:VARCHAR(*)</td><td>An IVOA identifier of a person or organization</td></tr>
<tr class="data even"><td>street_address <br/>N/A</td><td>adql:VARCHAR(*)</td><td>A mailing address for a person or organization</td></tr>
<tr class="data"><td>email <br/>N/A</td><td>adql:VARCHAR(*)</td><td>An email address the entity can be reached at</td></tr>
<tr class="data even"><td>telephone <br/>N/A</td><td>adql:VARCHAR(*)</td><td>A telephone number the entity can be reached at</td></tr>
<tr class="data"><td>logo <br/>N/A</td><td>adql:VARCHAR(*)</td><td>URL pointing to a graphical logo, which may be used to help identify the entity</td></tr>
<tr class="data even"><td>base_role <br/>N/A</td><td>adql:VARCHAR(*)</td><td>The role played by this entity; this is one of contact, publisher, and creator</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The <code>ivoid</code> column should be an explicit foreign key into
the <code>resource</code> table.  It is recommended to maintain indexes
on at least the <code>role_name</code> column, ideally in a way that
supports regular expressions.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>role_ivoid</code>,
<code>base_role</code>.
Clients are advised to query the remaining columns, in particular
<code>role_name</code>,
case-insensitively, e.g., using <code>ivo_nocasematch</code>.</p>

</div> <!-- subsection table_res_role -->


<div class="section"><h3><a id="table_res_subject"><span class="secnum">8.3. </span>The res_subject Table</a></h3>

<p>Since subject queries are expected to be frequent and perform relatively
complex checks (e.g., resulting from thesaurus queries in the clients), the
subjects are kept in a separate table rather than being hash-joined like other
string-like 1:n members of resource.</p>

<!-- GENERATED: maketable.sh rr.res_subject -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>res_subject <br/>xpath:subject</td><td>adql:VARCHAR(*)</td><td>Topics, object types, or other descriptive keywords about the resource.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The <code>ivoid</code>  column should be an explicit foreign key into
<code>resource</code>.  It is recommended to index the
<code>res_subject</code> column, preferably in a way that allows to process
case-insensitive and pattern queries using the index.</p>

<p>The <code>ivoid</code> column MUST be lowercased during
ingestion.  Clients are advised query the <code>res_subject</code> column
case-insensitively, e.g., using <code>ivo_nocasematch</code>.</p>

</div> <!-- subsection table_subject -->


<div class="section"><h3><a id="table_capability"><span class="secnum">8.4. </span>The capability Table</a></h3>

<p>The capability table describes a resource's modes of interaction; it only
contains the members of the base type <code>vr:Capability</code>.
Members of derived types are kept in the <code>res_detail</code> table
(see <span class="xref"><a href="#table_res_detail">8.13</a></span>).</p>

<p>The table has a
<code>cap_index</code> to disambiguate multiple
capabilities on a single resource.  See section <span class="xref"><a href="#primarykeys">3</a></span> for details.</p>

<!-- GENERATED: maketable.sh rr.capability -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>cap_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>An arbitrary identifier of this capability within the resource.</td></tr>
<tr class="data"><td>cap_type <br/>xpath:@xsi:type</td><td>adql:VARCHAR(*)</td><td>The type of capability covered here.</td></tr>
<tr class="data even"><td>cap_description <br/>xpath:description</td><td>adql:VARCHAR(*)</td><td>A human-readable description of what this capability provides as part of the over-all service</td></tr>
<tr class="data"><td>standard_id <br/>xpath:@standardID</td><td>adql:VARCHAR(*)</td><td>A URI for a standard this capability conforms to.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->


<p>This table should have an explicit primary key made up of
<code>ivoid</code> and <code>cap_index</code>.
The <code>ivoid</code> column should be
an explicit foreign key into <code>resource</code>.
It is recommended to maintain indexes on at least the 
<code>cap_type</code> and <code>standard_id</code> columns.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>cap_type</code>, <code>standard_id</code>.
Clients are advised to query the <code>cap_description</code> column
using the <code>ivo_hasword</code> function.</p>

</div> <!-- subsection table_capability -->


<div class="section"><h3><a id="table_res_schema"><span class="secnum">8.5. </span>The res_schema Table</a></h3>

<p>The <code>res_schema</code> table corresponds to VODataService's
<code>schema</code> element.  It has been renamed to avoid clashes with
the SQL reserved word <code>SCHEMA</code>.</p>

<p>The table has a column <code>schema_index</code> to disambiguate
multiple schema elements on a single resource.  See section <span class="xref"><a href="#primarykeys">3</a></span> for details.</p>


<!-- GENERATED: maketable.sh rr.res_schema -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>schema_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>An arbitrary identifier for the res_schema rows belonging to a resource.</td></tr>
<tr class="data"><td>schema_description <br/>xpath:description</td><td>adql:VARCHAR(*)</td><td>A free text description of the tableset explaining in general how all of the tables are related.</td></tr>
<tr class="data even"><td>schema_name <br/>xpath:name </td><td>adql:VARCHAR(*)</td><td>A name for the set of tables.</td></tr>
<tr class="data"><td>schema_title <br/>xpath:title</td><td>adql:VARCHAR(*)</td><td>A descriptive, human-interpretable name for the table set.</td></tr>
<tr class="data even"><td>schema_utype <br/>xpath:utype</td><td>adql:VARCHAR(*)</td><td>An identifier for a concept in a data model that the data in this schema as a whole represent.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>This table should have an explicit primary key made up of
<code>ivoid</code> and <code>schema_index</code>.  The
<code>ivoid</code>  column should be an explicit foreign key into
<code>resource</code>.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>schema_name</code>, <code>schema_utype</code>.
Clients are advised to query the <code>schema_description</code> 
and <code>schema_title</code> columns
using the the <code>ivo_hasword</code> function.</p>


</div> <!-- subsection table_res_schema -->


<div class="section"><h3><a id="table_res_table"><span class="secnum">8.6. </span>The res_table Table</a></h3>

<p>The <code>res_table</code> table models VODataService's
<code>table</code> element.  It has been renamed to avoid name clashes
with the SQL reserved word <code>TABLE</code>.</p>

<p>VODataService 1.0 had a similar element that was a direct child of
resource.  Ingestors should also accept such tables, as there are still
numerous active VODataService 1.0 resources in the Registry at the time
of writing (this is the reason for the alternative in the table xpath).</p>

<p>The table contains a column <code>table_index</code> to disambiguate
multiple tables on a single resource.  See section <span class="xref"><a href="#primarykeys">3</a></span> for details.  Note that if the sibling
count is used as implemenation of <code>table_index</code>, the count
must be per resource an <em>not</em> per schema—, as
<code>table_index</code> MUST be unique within a resource.</p>

<!-- GENERATED: maketable.sh rr.res_table -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>schema_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>Index of the schema this table belongs to, if it belongs to a schema (otherwise NULL).</td></tr>
<tr class="data"><td>table_description <br/>xpath:description</td><td>adql:VARCHAR(*)</td><td>A free-text description of the table's contents</td></tr>
<tr class="data even"><td>table_name <br/>xpath:name</td><td>adql:VARCHAR(*)</td><td>The fully qualified name of the table. This name should include all catalog or schema prefixes needed to distinguish it in a query.</td></tr>
<tr class="data"><td>table_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>An arbitrary identifier for the tables belonging to a resource</td></tr>
<tr class="data even"><td>table_title <br/>xpath:title</td><td>adql:VARCHAR(*)</td><td>A descriptive, human-interpretable name for the table</td></tr>
<tr class="data"><td>table_type <br/>xpath:@type</td><td>adql:VARCHAR(*)</td><td>A name for the role this table plays. Recognized values include "output", indicating this table is output from a query; "base_table", indicating a table whose records represent the main subjects of its schema; and "view", indicating that the table represents a useful combination or subset of other tables. Other values are allowed.</td></tr>
<tr class="data even"><td>table_utype <br/>xpath:utype</td><td>adql:VARCHAR(*)</td><td>An identifier for a concept in a data model that the data in this table as a whole represent.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>This table should have an explicit primary key made up of
<code>ivoid</code> and <code>table_index</code>.  The 
<code>ivoid</code> column should be an explicit
foreign key into <code>resource</code>.  It is recommended to
maintain an index on at least the <code>table_description</code>
column, ideally one suited for queries with <code>ivo_hasword</code>.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>table_name</code>, <code>table_type</code>,
<code>table_utype</code>.
Clients are advised to query the <code>table_description</code>
and <code>table_title</code>  columns
using the the <code>ivo_hasword</code> function.</p>


</div> <!-- subsection table_res_table -->




<div class="section"><h3><a id="table_table_column"><span class="secnum">8.7. </span>The table_column Table</a></h3>

<p>The <code>table_column</code>  table models the content of VODataService's
<code>column</code> element.  The table has been renamed to avoid
a name clash with the SQL reserved word <code>COLUMN</code>.</p>

<p>Since it is expected that queries for column properties will be
fairly common in advanced queries, it is the column table that has the
unprefixed versions of common member names (name,  ucd,
utype, etc).</p>

<p>The <code>flag</code> column contains a concatenation of all values
of a <code>column</code> element's <code>flag</code> children, separated
by hash characters.  Use the <code>ivo_hashlist_has</code> function in
queries against <code>flag</code>.</p>

<p>The <code>table_column</code> table also includes information from
VODataService's data type concept.  VODataService 1.1 includes several type
systems (VOTable, ADQL, Simple).  The
<code>type_system</code> column contains the value of the column's 
<code>datatype</code> child, with the VODataService XML prefix fixed
to vs; hence, this column will contain one of NULL,
<code>vs:taptype</code>,
<code>vs:simpledatatype</code>, and <code>vs:votabletype</code>.</p>

<!-- GENERATED: maketable.sh rr.table_column -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>table_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>Index of the table this column belongs to.</td></tr>
<tr class="data"><td>name <br/>xpath:name</td><td>adql:VARCHAR(*)</td><td>The name of the column.</td></tr>
<tr class="data even"><td>ucd <br/>xpath:ucd</td><td>adql:VARCHAR(*)</td><td>A unified content descriptor that describes the scientific content of the parameter.</td></tr>
<tr class="data"><td>unit <br/>xpath:unit</td><td>adql:VARCHAR(*)</td><td>The unit associated with all values in the column.</td></tr>
<tr class="data even"><td>utype <br/>xpath:utype</td><td>adql:VARCHAR(*)</td><td>An identifier for a role in a data model that the data in this column represents.</td></tr>
<tr class="data"><td>std <br/>xpath:@std</td><td>adql:SMALLINT</td><td>If 1, the meaning and use of this parameter is reserved and defined by a standard model. If 0, it represents a database-specific parameter that effectively extends beyond the standard.</td></tr>
<tr class="data even"><td>datatype <br/>xpath:dataType</td><td>adql:VARCHAR(*)</td><td>The type of the data contained in the column.</td></tr>
<tr class="data"><td>extended_schema <br/>xpath:dataType/@extendedSchema</td><td>adql:VARCHAR(*)</td><td>An identifier for the schema that the value given by the extended attribute is drawn from.</td></tr>
<tr class="data even"><td>extended_type <br/>xpath:dataType/@extendedType</td><td>adql:VARCHAR(*)</td><td>A custom type for the values this column contains.</td></tr>
<tr class="data"><td>arraysize <br/>xpath:dataType/@arraysize</td><td>adql:VARCHAR(*)</td><td>The shape of the array that constitutes the value, e.g., 4, *, 4*, 5x4, or 5x*, as specified by VOTable.</td></tr>
<tr class="data even"><td>delim <br/>xpath:dataType/@delim</td><td>adql:VARCHAR(*)</td><td>The string that is used to delimit elements of an array value when arraysize is not '1'.</td></tr>
<tr class="data"><td>type_system <br/>xpath:dataType/@xsi:type</td><td>adql:VARCHAR(*)</td><td>The type system used, as a QName with a canonical prefix; this will ususally be one of vs:simpledatatype, vs:votabletype, and vs:taptype.</td></tr>
<tr class="data even"><td>flag <br/>xpath:flag</td><td>adql:VARCHAR(*)</td><td>Hash-separated keywords representing traits of the column. Recognized values include "indexed", "primary", and "nullable".</td></tr>
<tr class="data"><td>column_description <br/>xpath:description</td><td>adql:VARCHAR(*)</td><td>A free-text description of the column's contents.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The pair <code>ivoid</code>, <code>table_index</code> should be an
explicit foreign key into <code>res_table</code>.  It is recommended to
maintain indexes on at least the <code>column_description</code>,
<code>name</code>, <code>ucd</code>, and <code>utype</code> columns,
where the index on <code>column_description</code> should ideally be able
to handle queries using <code>ivo_hasword</code>.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>name</code>, <code>ucd</code>,
<code>utype</code>, <code>datatype</code>, <code>type_system</code>.
The boolean value of the column's <code>std</code> attribute must be
converted to 0 (False), 1 (True), or NULL (not given) on ingestion.
Clients are advised to query the <code>description</code>
column using the <code>ivo_hasword</code> function, and to query
the <code>flag</code> column using the <code>ivo_hashlist_has</code>
function.</p>


</div> <!-- subsection table_table_column  -->

<div class="section"><h3><a id="table_interface"><span class="secnum">8.8. </span>The interface Table</a></h3>

<p>The <code>interface</code> table subsumes both the
<code>vr:Interface</code> and <code>vr:accessURL</code> types from
VOResource.  The integration of <code>accessURL</code>  into
the <code>interface</code>  table means that an interface in the
relational registry can only have one access URL, where in VOResource it
can have many.  In practice, this particular VOResource capability has
not been used by registry record authors.  Since access URLs are
probably the item most queried for, it seems warranted to save one
indirection when querying for them.</p>

<p>This specification deprecates the <code>maxOccurs="unbounded"</code>
in the definition of <code>Interface</code>'s <code>accessURL</code>
child in the XML schema
<code>http://www.ivoa.net/xml/VOResource/v1.0</code>; in future versions
of VOResource, implementations can expect this to be
<code>maxOccurs="1"</code>.  Meanwhile, implementation behavior in the
presence of multiple access URLs in an interface is undefined.</p>

<p>The table contains a column <code>intf_index</code> to disambiguate
multiple interfaces of one resource. See section <span class="xref"><a href="#primarykeys">3</a></span> for details.</p>

<p>In VOResource, interfaces can have zero or more <code>securityMethod</code>
children to convey support for authentication and authorization methods.  At
the time of writing, only a <code>standardId</code> attribute is defined on
these, and the Registry only contains a single resource record using
<code>securityMethod</code>.  It was therefore decided to map this information
into the <code>res_detail</code> table using the detail xpath
<code>/capability/interface/securityMethod/@standardID</code>, with
<code>cap_index</code> set so the embedding capability is referenced;
this implies that RegTAP does not allow distinguishing between
interfaces for security methods.  If <code>securityMethod</code> will
come into common use as the VO evolves, this design will be reconsidered
if reliable RegTAP-based discovery of access URLs in multi-interface
multi-authentication scenarios is found necessary.</p>

<p>The <code>query_type</code> column is a hash-joined list (analogous
to <code>waveband</code>, etc. in the resource table), as
the XML schema allows listing up to two request methods.</p>

<p>This table only contains interface elements from within capabilities.
Interface elements in StandardsRegExt records are ignored in the
relational registry,
and they must not be inserted in this table, since doing so would disturb
the foreign key from interface into capability.  In other words,
the relational registry requires every interface to have a parent capability.</p>

<p>Analogous to <code>resource.res_type</code>, the
<code>intf_type</code> column contains type names; VOResource extensions
can define new types here, but at the time of writing, the following
types are mentioned in IVOA-recommended schemata:</p>

<dl>
<dt>vs:paramhttp</dt>
<dd>A service invoked via an HTTP query with either form-urlencoded or
multipart form-data parameters.</dd>
<dt>vr:webbrowser</dt>
<dd>A (form-based) interface intended to be accessed interactively by a
user via a web browser.</dd>
<dt>vg:oaihttp</dt>
<dd>A standard OAI PMH interface using HTTP queries with form-urlencoded
parameters.</dd>
<dt>vg:oaisoap</dt>
<dd>A standard OAI PMH interface using a SOAP Web Service
interface.</dd>
<dt>vr:webservice</dt>
<dd>A Web Service that is describable by a WSDL document.</dd>
</dl>

<!-- GENERATED: maketable.sh rr.interface -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>cap_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>The index of the parent capability.</td></tr>
<tr class="data"><td>intf_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>An arbitrary identifier for the interfaces of a resource.</td></tr>
<tr class="data even"><td>intf_type <br/>xpath:@xsi:type</td><td>adql:VARCHAR(*)</td><td>The type of the interface (vr:webbrowser, vs:paramhttp, etc).</td></tr>
<tr class="data"><td>intf_role <br/>xpath:@role</td><td>adql:VARCHAR(*)</td><td>An identifier for the role the interface plays in the particular capability. If the value is equal to "std" or begins with "std:", then the interface refers to a standard interface defined by the standard referred to by the capability's standardID attribute.</td></tr>
<tr class="data even"><td>std_version <br/>xpath:@version</td><td>adql:VARCHAR(*)</td><td>The version of a standard interface specification that this interface complies with. When the interface is provided in the context of a Capability element, then the standard being refered to is the one identified by the Capability's standardID element.</td></tr>
<tr class="data"><td>query_type <br/>xpath:queryType</td><td>adql:VARCHAR(*)</td><td>Hash-joined list of expected HTTP method (get or post) supported by the service.</td></tr>
<tr class="data even"><td>result_type <br/>xpath:resultType</td><td>adql:VARCHAR(*)</td><td>The MIME type of a document returned in the HTTP response.</td></tr>
<tr class="data"><td>wsdl_url <br/>xpath:wsdlURL</td><td>adql:VARCHAR(*)</td><td>The location of the WSDL that describes this Web Service. If NULL, the location can be assumed to be the accessURL with '?wsdl' appended.</td></tr>
<tr class="data even"><td>url_use <br/>xpath:accessURL/@use</td><td>adql:VARCHAR(*)</td><td>A flag indicating whether this should be interpreted as a base URL ('base'), a full URL ('full'), or a URL to a directory that will produce a listing of files ('dir').</td></tr>
<tr class="data"><td>access_url <br/>xpath:accessURL</td><td>adql:VARCHAR(*)</td><td>The URL at which the interface is found.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>This table should have the pair <code>ivoid</code>, <code>cap_index</code>
as an explicit foreign key into
<code>capability</code>, and the pair <code>ivoid</code>, and
<code>intf_index</code> as an explicit primary key. Additionally, it
is recommended to maintain an index on at least the
<code>intf_type</code> column.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>intf_type</code>, <code>intf_role</code>,
<code>std_version</code>, <code>query_type</code>,
<code>result_type</code>, <code>url_use</code>.
Clients are advised to query <code>query_type</code> using the the
<code>ivo_hashlist_has</code> function.</p>

</div> <!-- subsection table_interface -->

<div class="section"><h3><a id="table_intf_param"><span class="secnum">8.9. </span>The intf_param Table</a></h3>

<p>The <code>intf_param</code> table keeps information on the parameters
available on interfaces.  It is therefore closely related to
<code>table_column</code>, but the differences between the two are
significant enough to warrant a separation between the two tables.
Since the names of common column attributes are used where applicable in
both tables (e.g., name, ucd, etc), the two tables cannot be (naturally)
joined.</p>

<!-- GENERATED: maketable.sh rr.intf_param -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>intf_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>The index of the interface this parameter belongs to.</td></tr>
<tr class="data"><td>name <br/>xpath:name</td><td>adql:VARCHAR(*)</td><td>The name of the parameter.</td></tr>
<tr class="data even"><td>ucd <br/>xpath:ucd</td><td>adql:VARCHAR(*)</td><td>A unified content descriptor that describes the scientific content of the parameter.</td></tr>
<tr class="data"><td>unit <br/>xpath:unit</td><td>adql:VARCHAR(*)</td><td>The unit associated with all values in the parameter.</td></tr>
<tr class="data even"><td>utype <br/>xpath:utype</td><td>adql:VARCHAR(*)</td><td>An identifier for a role in a data model that the data in this parameter represents.</td></tr>
<tr class="data"><td>std <br/>xpath:@std</td><td>adql:SMALLINT</td><td>If 1, the meaning and use of this parameter is reserved and defined by a standard model. If 0, it represents a database-specific parameter that effectively extends beyond the standard.</td></tr>
<tr class="data even"><td>datatype <br/>xpath:dataType</td><td>adql:VARCHAR(*)</td><td>The type of the data contained in the parameter.</td></tr>
<tr class="data"><td>extended_schema <br/>xpath:dataType/@extendedSchema</td><td>adql:VARCHAR(*)</td><td>An identifier for the schema that the value given by the extended attribute is drawn from.</td></tr>
<tr class="data even"><td>extended_type <br/>xpath:dataType/@extendedType</td><td>adql:VARCHAR(*)</td><td>A custom type for the values this parameter contains.</td></tr>
<tr class="data"><td>arraysize <br/>xpath:dataType/@arraysize</td><td>adql:VARCHAR(*)</td><td>The shape of the array that constitutes the value, e.g., 4, *, 4*, 5x4, or 5x*, as specified by VOTable.</td></tr>
<tr class="data even"><td>delim <br/>xpath:dataType/@delim</td><td>adql:VARCHAR(*)</td><td>The string that is used to delimit elements of an array value when arraysize is not '1'.</td></tr>
<tr class="data"><td>param_use <br/>xpath:@use</td><td>adql:VARCHAR(*)</td><td>An indication of whether this parameter is required to be provided for the application or service to work properly (one of required, optional, ignored, or NULL).</td></tr>
<tr class="data even"><td>param_description <br/>xpath:description</td><td>adql:VARCHAR(*)</td><td>A free-text description of the parameter's contents.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The pair 
<code>ivoid</code>, <code>intf_index</code>
should be an explicit foreign key into <code>interface</code>.</p>

<p>The remaining requirements and conventions are as per
section <span class="xref"><a href="#table_table_column">8.7</a></span>
where applicable, and <code>param_description</code> taking the role
of <code>column_description</code>.</p>
</div> <!-- subsection table_intf_param -->


<div class="section"><h3><a id="table_relationship"><span class="secnum">8.10. </span>The relationship Table</a></h3>

<p>The relationship element is a slight denormalization of the
<code>vr:Relationship</code> type: Whereas in VOResource, a single
relationship element can take several IVORNs, in the relational model,
the pairs are stored directly.  It is straightforward to translate
between the two representations in the database ingestor.</p>


<!-- GENERATED: maketable.sh rr.relationship -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>relationship_type <br/>xpath:relationshipType</td><td>adql:VARCHAR(*)</td><td>The named type of relationship; this can be mirror-of, service-for, served-by, derived-from, related-to, or something user-defined.</td></tr>
<tr class="data"><td>related_id <br/>xpath:relatedResource/@ivo-id</td><td>adql:VARCHAR(*)</td><td>The URI form of the IVOA identifier for the resource refered to.</td></tr>
<tr class="data even"><td>related_name <br/>xpath:relatedResource</td><td>adql:VARCHAR(*)</td><td>The name of resource that this resource is related to.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The
<code>ivoid</code> column should be an explicit foreign key into the
<code>resource</code> table.  You should index at least the
<code>related_id</code> column.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>relationship_type</code>,
<code>related_id</code>.</p>

</div> <!-- subsection table_relationship -->

<div class="section"><h3><a id="table_validation"><span class="secnum">8.11. </span>The validation Table</a></h3>

<p>The <code>validation</code> subsumes the
<code>vr:validationLevel</code>-typed members of both <code>vr:Resource</code>
and <code>vr:Capability</code>.</p>

<p>If the <code>cap_index</code> column in <code>NULL</code> the
validation comprises the entire resource.  Otherwise, only the
referenced capability has been validated.</p>

<p>While it is recommended that harvesters only accept resource records
from their originating registries, it is valuable to gather validation
results from various sources.  Hence, harvesters for the relational
registry may choose to obtain validation data from the OAI-PMH endpoints
of various registries by not harvesting just for the ivo_managed set and
generate <code>rr.validation</code> rows from these records.  This can
trigger potentially problematic behavior when the original registry
updates  its resource record in that naive implementations will lose all
third-party validation rows; this may actually be the correct behavior,
since an update of the registry record might very well indicate
validation-relevant changes in the underlying services.  Implementations
are free to handle or ignore validation results as they see fit, and
they may add validation results of their own.</p>

<p>The validation levels are defined in <cite>[<a href="#std:RM">std:RM</a>]</cite> and
currently range from 0 (description stored in a registry) to 
4 (inspected by a human to be technically and scientifically
correct).</p>

<!-- GENERATED: maketable.sh rr.validation -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>validated_by <br/>xpath:validationLevel/@validatedBy</td><td>adql:VARCHAR(*)</td><td>The IVOA ID of the registry or organisation that assigned the validation level.</td></tr>
<tr class="data"><td>val_level <br/>xpath:validationLevel</td><td>adql:SMALLINT</td><td>A numeric grade describing the quality of the resource description, when applicable, to be used to indicate the confidence an end-user can put in the resource as part of a VO application or research study.</td></tr>
<tr class="data even"><td>cap_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>If non-NULL, the validation only refers to the the capability referenced here.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The
<code>ivoid</code> should be an explicit foreign key into <code>resource</code>.
Note, however, that <code>ivoid</code>, <code>cap_index</code> is
<em>not</em> a foreign key into <code>capability</code> since
<code>cap_index</code> may be <code>NULL</code> (in case the validation
addresses the entire resource).</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>validated_by</code>.</p>

</div> <!-- subsection table_validation -->


<div class="section"><h3><a id="table_res_date"><span class="secnum">8.12. </span>The res_date Table</a></h3>

<p>The <code>res_date</code> table contains information gathered from
<code>vr:Curation</code>'s date children.</p>

<!-- GENERATED: maketable.sh rr.res_date -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>date_value <br/>xpath:date</td><td>adql:TIMESTAMP</td><td>A date associated with an event in the life cycle of the resource.</td></tr>
<tr class="data"><td>value_role <br/>xpath:date/@role</td><td>adql:VARCHAR(*)</td><td>A string indicating what the date refers to, e.g., created, availability, updated.</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The <code>ivoid</code> column should be an explicit foreign key into
<code>resource</code>.</p>

<p>The following columns MUST be lowercased during ingestion:
<code>ivoid</code>, <code>value_role</code>.</p>
</div> <!-- subsection table_res_date -->

<div class="section"><h3><a id="table_res_detail"><span class="secnum">8.13. </span>The res_detail Table</a></h3>

<p>The <code>res_detail</code> table is the relational registry's primary means for
extensibility as well as a fallback for less-used simple
metadata.  Conceptually, it stores triples of resource entity
references, resource xpaths,
and values, where resource entities can be resource records themselves
or capabilities.  Thus, metadata with values that are either
string-valued or sets of strings can be represented in this table.</p>

<p>As long as the metadata that needs to be represented in the
relational registry for new VOResource extensions is simple enough, no changes to the schema defined
here will be neccessary as these are introduced.  Instead, the extension itself simply defines
new xpaths to be added in <code>res_detail</code>.</p>

<p>Some complex metadata—<code>tr:languageFeature</code> or
<code>vstd:key</code> being examples—cannot be kept in this table.
If a representation of such information in the relational registry is
required, this standard will need to be changed.</p>

<p>Appendix <span class="xref"><a href="#d_u_list">A</a></span> gives a list
of resource xpaths from the registry extensions
that were recommendations at the time of writing.  
For the resource xpaths marked with an exclamation mark there,
xpath/value pairs MUST be generated whenever the corresponding
metadata items are given in a resource record.
For the remaining resource xpaths, these pairs should be provided if
convenient; they mostly concern test queries and other curation-type
information that, while unlikely to be useful to normal users, may be
relevant to curation-type clients that, e.g., ascertain the continued 
operation of services.</p>

<p>Some detail values must be interpreted case-insensitively; this
concerns, in particular, IVORNs like the TAP data model type.  For other
rows—the test queries are immediate examples—, changing the case
will likely break the data.  In order to avoid having to give and
implement case normalization rules by detail xpath, no case normalization 
is done on detail values at all, and users and clients will have to use
the <code>ivo_nocasematch</code> user defined function (see section
<span class="xref"><a href="#adqludf">9</a></span>) when locating
case-insensitive values.  For the resource xpaths given in Appendix <span class="xref"><a href="#d_u_list">A</a></span>, this concerns all items with xpaths ending
in <code>@ivo-id</code>.</p>

<p>Individual
ingestors
MAY choose to expose additional metadata using other utypes, provided
they are formed according to the rules in 
section <span class="xref"><a href="#vorutypes">6</a></span> (this rule is intended
to minimize the risk of later clashes).</p>

<p>In addition to the metadata listed in this specification, 
metadata defined in future
IVOA-approved VOResource extensions MUST or SHOULD be present in
<code>res_details</code> as the extensions require it.</p>


<!-- GENERATED: maketable.sh rr.res_detail -->
<div class="tablewrap"><table class="results" frame="box" rules="rows"><thead><tr><th class="thVertical">Name<br/>Utype</th><th class="thVertical">Type</th><th class="thVertical">Description</th></tr></thead><tbody><tr class="data"><td>ivoid <br/>xpath:/identifier</td><td>adql:VARCHAR(*)</td><td>The parent resource.</td></tr>
<tr class="data even"><td>cap_index <br/>N/A</td><td><a href="#primarykeys">(key)</a></td><td>The index of the parent capability; if NULL the xpath-value pair describes a member of the entire resource.</td></tr>
<tr class="data"><td>detail_xpath <br/>N/A</td><td>adql:VARCHAR(*)</td><td>The xpath of the data item</td></tr>
<tr class="data even"><td>detail_value <br/>N/A</td><td>adql:VARCHAR(*)</td><td>(Atomic) value of the member</td></tr>
</tbody></table></div>
<!-- /GENERATED -->

<p>The <code>ivoid</code> column should be an explicit foreign key into
<code>resource</code>.  It is recommended to maintain indexes on
at least the columns
<code>detail_xpath</code> and <code>detail_value</code>, where the
indices on <code>detail_value</code> should ideally work for both direct
comparisons and searches using the <code>ivo_nocasematch</code>
function.</p>

<p>The following column MUST be lowercased during ingestion:
<code>ivoid</code>.  Clients are advised to
use the <code>ivo_nocasematch</code> function to search in
<code>detail_value</code> if the values are to be compared
case-insensitively (e.g., all IVORNs).</p>
</div> <!-- subsection table_res_detail -->

</div> <!-- section vortables -->


<div class="section"><h2><a id="adqludf"><span class="secnum">9. </span>ADQL User Defined Functions</a></h2>

<p>TAP Servers implementing the 
<code>ivo://ivoa.net/std/RegTAP#1.0</code> data model MUST 
implement the following three functions in their ADQL 2.0 language,
with signatures written as recommended in <cite>[<a href="#std:TAPREGEXT">std:TAPREGEXT</a>]</cite>:</p>

<dl>
<dt><code>ivo_nocasematch(value VARCHAR(*), pattern VARCHAR(*))-&gt;INTEGER</code></dt>
<dd>
The function returns 1 if <code>pattern</code>  matches
<code>value</code>, 0 otherwise.
<code>pattern</code>  is defined as for the SQL LIKE operator, but the
match is performed case-insensitively.
</dd>
<dt><code>ivo_hasword(haystack VARCHAR(*), needle VARCHAR(*)) -&gt; INTEGER</code></dt>
<dd>The function takes two strings and returns 1 if the second is
contained in the first one in a "word" sense, i.e., delimited by
non-letter characters or the beginning or end of the string, where case
is ignored.
Additionally, servers MAY employ techniques to improve recall, in
particular stemming.  Registry clients must hence expect different results
from different servers when using <code>ivo_hasword</code>; for such
queries trying them on multiple registries may improve recall.</dd>
<dt><code>ivo_hashlist_has(hashlist VARCHAR(*), item VARCHAR(*))-&gt;INTEGER</code></dt>
<dd>The function takes two strings; the first is a list of words not
containing the hash sign (#), concatenated by hash signs, the second is
a word not containing the hash sign.  It returns 1 if, compared
case-insensitively, the second argument is in the list of words encoded in
the first argument.  The behavior for second
arguments containing a hash sign is undefined.</dd>
</dl>

<p>Reference implementations of the three functions for the PostgreSQL
database system are given in Appendix <span class="xref"><a href="#appPGDefs">B</a></span>.</p>

</div><!-- section adqludf -->

<div class="section" vocab="ivo://ivoa.net/std/DALI#examples"><h2><a id="sample_queries"><span class="secnum">10. </span>Common Queries to the Relational Registry</a></h2>

<p>This section contains sample queries to the relational registry,
mostly contributed as use cases by various members of the IVOA Registry
working group.  They are intended as an aid in designing relational
registry queries, in particular for users new to the data model.</p>

<p>When locating access URLs for capabilities of standard services,
these sample queries look for interfaces of type <code>vs:ParamHTTP</code> 
within the
embedding capabilities.  This is not strictly as intended by VOResource,
which has the special <code>role</code> attribute to mark the interface
on which a standard protocol is exposed within a capability.  In
RegTAP, this method of locating standard interfaces would be effected by
constraining
<code>intf_role LIKE 'std%'</code>.  In actual VO practice, too many
standard interfaces are lacking a proper declaration of their role, and
actual clients locate the standard interfaces as given here.  Following
widespread practice client designers are encouraged to compare
against the interface types rather than rely on
<code>interface/@role</code>, and resource record authors should make
sure clients can discover standard interfaces both by the interfaces'
roles and types.</p>

<div class="query-example" typeof="example" id="example-accurlbytype">
<h3 property="name">TAP accessURLs</h3>
<p class="problem"><strong>Problem:</strong> Find all TAP services; return their accessURLs</p>

<p>As the capability type is in <span property="table">rr.capability</span>, whereas the access URL can be
found from <span property="table">rr.interface</span>, this requires
a join:</p>

<pre class="querysample" property="query">
SELECT ivoid, access_url 
FROM rr.capability
NATURAL JOIN rr.interface
WHERE standard_id='ivo://ivoa.net/std/tap'
  AND intf_type='vs:paramhttp'
</pre>

<p>Other <code>standard_id</code>s relevant here include:</p>

<ul>
<li><code>ivo://ivoa.net/std/registry</code> for OAI-PMH services,</li>
<li><code>ivo://ivoa.net/std/sia</code> for SIA services,</li>
<li><code>ivo://ivoa.net/std/conesearch</code> for SCS services,
and</li>
<li><code>ivo://ivoa.net/std/ssa</code> for SSA services.</li>
</ul>
</div>

<div class="query-example" typeof="example" id="example-siaspiral">
<h3 property="title">Image Services with Spirals</h3>
<p class="problem"><strong>Problem:</strong> Find all SIA services that might have spiral
galaxies</p>
<p>This is somewhat tricky since it is probably hard to image a part
of the sky guaranteed not to have some, possibly distant, spiral galaxy
in it.  However, translating the intention into "find all SIA services
that mention spiral in either the subject (from <span property="table">rr.res_subject</span>), the description, or the
title (which are in <span property="table">rr.resource</span>)", 
the query would become:</p>

<pre class="samplequery" property="query">
SELECT ivoid, access_url 
FROM rr.capability 
  NATURAL JOIN rr.resource
  NATURAL JOIN rr.interface
  NATURAL JOIN rr.res_subject
WHERE standard_id='ivo://ivoa.net/std/sia'
  AND intf_type='vs:paramhttp'
  AND (
    1=ivo_nocasematch(res_subject, '%spiral%')
    OR 1=ivo_hasword(res_description, 'spiral')
    OR 1=ivo_hasword(res_title, 'spiral'))
</pre>
</div>

<div class="query-example" typeof="example" id="example-siainfrared">
<h3 property="name">Infrared Image Services</h3>
<p class="problem"><strong>Problem:</strong> Find all SIA services that provide infrared
images</p>

<p>The waveband information in <span property="table">rr.resource</span>
comes in hash-separated atoms (which can be
radio, millimeter, infrared, optical, uv, euv, x-ray, or gamma-ray).
For matching those, use the <code>ivo_hashlist_has</code> function as
below.  The access URL and the service standard come from <span property="table">rr.interface</span> and <span property="table">rr.capability</span>, respectively.</p>

<pre class="samplequery" property="query">
SELECT ivoid, access_url 
FROM rr.capability 
  NATURAL JOIN rr.resource
  NATURAL JOIN rr.interface
WHERE standard_id='ivo://ivoa.net/std/sia'
  AND intf_type='vs:paramhttp'
  AND 1=ivo_hashlist_has('infrared', waveband)
</pre>
</div>

<div class="query-example" typeof="example" id="example-redshiftcol">
<h3 property="name">Catalogs with Redshifts</h3>
<p class="problem"><strong>Problem:</strong> Find all searchable catalogs (i.e., cone search
services) that provide a column containing redshifts</p>

<p>Metadata on columns exposed by a service are contained in <span property="table">rr.table_column</span>.  Again, this table can be
naturally joined with <span property="table">rr.capability</span>
and <span property="table">rr.interface</span>:</p>

<pre class="samplequery" property="query">
SELECT ivoid, access_url 
FROM rr.capability 
  NATURAL JOIN rr.table_column
  NATURAL JOIN rr.interface 
WHERE standard_id='ivo://ivoa.net/std/conesearch'
  AND intf_type='vs:paramhttp'
  AND ucd='src.redshift'
</pre>

<p>Sometimes you want to match a whole set of ucds.  Frequently the
simple regular expressions of SQL will help, as in 
<code>AND ucd LIKE 'pos.parallax%' </code>.  When that is not enough, 
use boolean OR expressions </p>
</div>

<div class="query-example" typeof="example" id="example-authres">
<h3 property="name">Names from an Authority</h3>
<p class="problem"><strong>Problem:</strong> Find all the resources published by a certain
authority</p>

<p>An "authority" within the VO is something that hands out identifiers.
You can tell what authority a record came from by looking at the "host
part" of the IVO identifier, most naturally obtained from <span property="table">rr.resource</span>.  Since ADQL cannot actually parse
URIs, we make do with simple string matching:</p>
<pre class="samplequery" property="query">
SELECT ivoid 
FROM rr.resource
WHERE ivoid LIKE 'ivo://org.gavo.dc%'
</pre>
</div>

<div class="query-example" typeof="example" id="example-frompublisher">
<h3 property="name">Records Published by X</h3>
<p class="problem"><strong>Problem:</strong> What registry records are there from a given
publisher?</p>

<p>This uses the <span property="table">rr.res_role</span> table both
match names (in this case, a publisher that has "gavo" in its name) and
to ascertain the named entity actually publishes the resource (rather
than, e.g., just being the contact in case of trouble).  The result is a
list of ivoids in this case.  You could join this with any other
table in the relational registry to find out more about these
services.</p>

<pre class="samplequery" property="query">
SELECT ivoid 
FROM rr.res_role
WHERE 1=ivo_nocasematch(role_name, '%gavo%')
  AND base_role='publisher'
</pre>
<p>or, if the publisher actually gives its ivo-id in the registry
records,</p>
<pre class="samplequery">
SELECT ivoid 
FROM rr.res_role
WHERE role_ivoid='ivo://ned.ipac/ned'
  AND base_role='publisher'
</pre>
</div>


<div class="query-example" typeof="example" id="example-regoriginate">
<h3 property="name">Records from Registry</h3>

<p class="problem"><strong>Problem:</strong> What registry records are
there originating from registry X?</p>

<p>This is mainly a query interesting for registry maintainers.  Sill,
it is a nice example for joining with the
<span property="table">rr.res_detail</span> table, in this case to
first get a list of all authorities managed by the CDS registry.</p>

<pre class="samplequery" property="query">
SELECT ivoid FROM rr.resource
RIGHT OUTER JOIN (
  SELECT 'ivo://' || detail_value || '%' AS pat FROM rr.res_detail
  WHERE detail_xpath='/managedAuthority' 
    AND ivoid='ivo://cds.vizier/registry') 
  AS authpatterns
ON (resource.ivoid LIKE authpatterns.pat)
</pre>
</div>



<div class="query-example" typeof="example" id="example-findregtap">
<h3 property="name">Locate RegTAP services</h3>
<p class="problem"><strong>Problem:</strong> Find all TAP endpoints offering the relational
registry</p>

<p>This is the discovery query for RegTAP services themselves;  note how
this combines <span property="table">rr.res_detail</span> pairs with
<span property="table">rr.capability</span> and <span property="table">rr.interface</span> to locate the desired protocol
endpoints.</p>

<pre class="samplequery" property="query">
SELECT access_url
FROM rr.interface
NATURAL JOIN rr.capability
NATURAL JOIN rr.res_detail
WHERE standard_id='ivo://ivoa.net/std/tap'
  AND intf_type='vs:paramhttp'
  AND detail_xpath='/capability/dataModel/@ivo-id'
  AND 1=ivo_nocasematch(detail_value, 'ivo://ivoa.net/std/regtap#1.0')
</pre>
</div>

<div class="query-example" typeof="example" id="example-glotsquery">
<h3 property="name">TAP with Physics</h3>
<p class="problem"><strong>Problem:</strong> Find all TAP services
exposing a table with certain features</p>

<p>"Certain features" could be "have some word in their description
and having a column with a certain UCD".  Either way, this kind of query
fairly invariably combines the usual <span property="table">rr.capability</span> and <span property="table">rr.interface</span> for service location with
<span property="table">rr.table_column</span> for the column metadata
and <span property="table">rr.res_table</span> for properties of tables.</p>

<pre class="samplequery" property="query">
SELECT ivoid, access_url, name, ucd, column_description
FROM rr.capability 
  NATURAL JOIN rr.interface
  NATURAL JOIN rr.table_column
  NATURAL JOIN rr.res_table
WHERE standard_id='ivo://ivoa.net/std/tap'
  AND intf_type='vs:paramhttp'
  AND 1=ivo_hasword(table_description, 'quasar')
  AND ucd='phot.mag;em.opt.v'
</pre>
</div>


<div class="query-example" typeof="example" id="example-theospectra">
<h3 property="name">Theoretical SSA</h3>

<p class="problem"><strong>Problem:</strong> Find all SSAP services that
provide theoretical spectra</p>

<p>The metadata required to solve this problem is found in the SSAP
registry extension and is thus kept in <span property="table">rr.res_detail</span>:</p>

<pre class="samplequery" property="query">
SELECT access_url 
FROM rr.res_detail 
  NATURAL JOIN rr.capability 
  NATURAL JOIN rr.interface 
WHERE detail_xpath='/capability/dataSource' 
  AND intf_type='vs:paramhttp'
  AND standard_id='ivo://ivoa.net/std/ssa'
  AND detail_value='theory'
</pre>
</div>


<div class="query-example" typeof="example" id="example-brokenservice">
<h3 property="name">Find Contact Persons</h3>
<p class="problem"><strong>Problem:</strong> The service at
http://dc.zah.uni-heidelberg.de/__system__/tap/run/tap is down, who can
fix it?</p>

<p>This uses the <span property="table">rr.res_role</span> table and
returns all information on it based on the IVORN of a service that in
turn was obtained from <span property="table">rr.interface</span>.  You
could restrict to the actual technical contact person by requiring
<code>base_role='contact'</code>.</p>

<pre class="samplequery" property="query">
SELECT DISTINCT base_role, role_name, email 
FROM rr.res_role 
  NATURAL JOIN rr.interface 
WHERE access_url='http://dc.zah.uni-heidelberg.de/__system__/tap/run/tap'
</pre>
</div>

<div class="query-example" typeof="example" id="example-caprelation">
<h3 property="name">Related Capabilities</h3>
<p class="problem"><strong>Problem:</strong> Get the capabilities of all services serving a
specific resource (typically, a data collection)</p>

<p>In the VO, data providers can register pure data collections without
access options (or just furnished with a link to a download).  They can
then declare that their data can be "served-by" some other resource,
typically a TAP service or some collective service for a number of
instruments.  To locate the access options to the data itself, inspect
<span property="table">rr.relationship</span> and use it to select records
from <span property="table">rr.capability</span>.</p>

<pre class="samplequery" property="query">
SELECT * 
FROM rr.relationship AS a
  JOIN rr.capability AS b 
    ON (a.related_id=b.ivoid) 
WHERE relationship_type='served-by'
</pre>
</div>


</div><!-- section sample_queries -->
</div><!-- class="body" -->

<div class="appendices">

<div class="section"><h2><a id="d_u_list"><span class="secnum">A. </span>XPaths for res_details</a></h2>

<p>This appendix defines the <code>res_details</code>
table (see section <span class="xref"><a href="#table_res_detail">8.13</a></span> for
details) by giving
xpaths for which xpath/value pairs MUST (where marked with an
exclamation mark) or SHOULD be given if the
corresponding data is present in the resource records.  This list is
normative for metadata defined in IVOA recommendations current as of the
publication of this document (see section <span class="xref"><a href="#rolewithinivoa">1.2</a></span>).  As laid down in section <span class="xref"><a href="#table_res_detail">8.13</a></span>, new VOResource extensions or new
versions of existing VOResource extensions may amend this list.</p>

<p>In case there are conflicts between this list and xpaths derived 
from schema files using the rules given in section <span class="xref"><a href="#vorutypes">6</a></span>, the conflict must be considered due to an
editorial oversight in the preparation of this list, and the xpaths from the
schema files are normative.  Errata to this list will be issued in such
cases.</p>

<p>The xpaths are sufficient for locating the respective metdata as per
section <span class="xref"><a href="#vorutypes">6</a></span>.  With the explanations we
give the canonical prefixes for the XML namespaces from which the items
originate, which is where further information can be found.</p>

<dl id="resutypes">
<dt>/accessURL (!)</dt> <dd>For data collection resources, this is
the URL that can be used to download the data contained.  Do
<em>not</em> enter accessURLs from interfaces into res_detail. (vs).</dd>
<dt>/capability/executionDuration/hard</dt> <dd>The hard run time limit, given in seconds (tr).</dd>
<dt>/capability/complianceLevel</dt> <dd>The category indicating the level to which this instance complies with the SSA standard (ssap).</dd>
<dt>/capability/creationType (!)</dt> <dd>The category that describes the process used to produce the dataset; one of archival, cutout, filtered, mosaic, projection, specialExtraction, catalogExtraction (ssap).</dd>
<dt>/capability/dataModel (!)</dt> <dd>The short, human-readable name of a data model supported by a TAP service; for most applications, clients should rather constrain /capability/dataModel/@ivo-id (tr).  </dd>
<dt>/capability/dataModel/@ivo-id (!)</dt> <dd>The IVORN of the data model supported by a TAP service (tr).</dd>
<dt>/capability/dataSource (!)</dt> <dd>The category specifying where the data originally came from; one of survey, pointed, custom, theory, artificial (ssap).</dd>
<dt>/capability/defaultMaxRecords (!)</dt> <dd>The largest number of records that the service will return when the MAXREC parameter is not specified in the query input (ssap).</dd>
<dt>/capability/executionDuration/default</dt> <dd>The run time limit for newly-created jobs, given in seconds (tr).</dd>
<dt>/capability/imageServiceType (!)</dt> <dd>The class of image service: Cutout, Mosaic, Atlas, Pointed (sia).</dd>
<dt>/capability/interface/securityMethod/@standardID (!)</dt><dd>A description of a security mechanism.  Although this really is a property of an interface, the reference here goes to the embedding capability, which is sufficient for discovery of the existence of such interfaces.  If the capability holds multiple interfaces, clients need other means (e.g., VOSI capabilities) to figure out the mapping between access URLs and suported security methods.</dd>
<dt>/capability/language/name (!)</dt> <dd>A short, human-readable name of a language understood by the TAP service (tr).</dd>
<dt>/capability/language/version/@ivo-id (!)</dt> <dd>The IVORN of a language supported by a TAP service (tr).</dd>
<dt>/capability/maxAperture</dt> <dd>The largest aperture that can be supported upon request via the APERTURE input parameter by a service that supports the special extraction creation method (ssap).</dd>
<dt>/capability/maxFileSize (!)</dt> <dd>The maximum image file size in bytes (sia).</dd>
<dt>/capability/maxImageExtent/lat</dt> <dd>The maximum size in the latitude (Dec.) direction (sia).</dd>
<dt>/capability/maxImageExtent/long</dt> <dd>The maximum size in the longitude (R.A.) direction (sia).</dd>
<dt>/capability/maxImageSize/lat</dt> <dd>The image size in the latitude (Dec.) direction in pixels (sia-1.0).</dd>
<dt>/capability/maxImageSize/long</dt> <dd>The image size in the longitude (R.A.) direction in pixels (sia-1.0).</dd>
<dt>/capability/maxImageSize</dt> <dd>A measure of the largest image the service can produce given as the maximum number of pixels along the first or second axes. (sia).</dd>
<dt>/capability/maxQueryRegionSize/lat</dt> <dd>The maximum size in the latitude (Dec.) direction (sia).</dd>
<dt>/capability/maxQueryRegionSize/long</dt> <dd>The maximum size in the longitude (R.A.) direction (sia).</dd>
<dt>/capability/maxRecords (!)</dt> <dd>The largest number of items (records, rows, etc) that the service will return (cs, sia, vg, ssap).</dd>
<dt>/capability/maxSearchRadius (!)</dt> <dd>The largest search radius, in degrees, that will be accepted by the service without returning an error condition. Not providing this element or specifying a value of 180 indicates that there is no restriction. (ssap)</dd>
<dt>/capability/maxSR (!)</dt> <dd>The largest search radius of a cone search service (cs).</dd>
<dt>/capability/outputFormat/@ivo-id (!)</dt> <dd>An IVORN of an output format (tr).</dd>
<dt>/capability/outputFormat/alias</dt> <dd>A short, mnemonic identifier for a service's output format (tr).</dd>
<dt>/capability/outputFormat/mime (!)</dt> <dd>The MIME type of an output format (tr).</dd>
<dt>/capability/outputLimit/default</dt> <dd>The maximal output size for newly-created jobs (tr).</dd>
<dt>/capability/outputLimit/default/@unit</dt> <dd>The unit (rows/bytes) in which the service's default output limit is given (tr).</dd>
<dt>/capability/outputLimit/hard</dt> <dd>The hard limit of a service's output size (tr).</dd>
<dt>/capability/outputLimit/hard/@unit</dt> <dd>The unit of this service's hard output limit (tr).</dd>
<dt>/capability/retentionPeriod/default</dt> <dd>The default time between job creation and removal on this service, given in seconds (tr).</dd>
<dt>/capability/retentionPeriod/hard</dt> <dd>The hard limit for the retention time of jobs on this services (tr).</dd>
<dt>/capability/supportedFrame (!)</dt> <dd>The STC name for a world coordinate system frame supported by this service (ssap).</dd>
<dt>/capability/testQuery/catalog</dt> <dd>The catalog to query (cs).</dd>
<dt>/capability/testQuery/dec</dt> <dd>Declination in a test query (cs)</dd>
<dt>/capability/testQuery/extras</dt> <dd>Any extra (non-standard) parameters that must be provided (apart from what is part of base URL given by the accessURL element; cs, sia).</dd>
<dt>/capability/testQuery/pos/lat</dt> <dd>The Declination of the center of the search position in decimal degrees (ssap, sia).</dd>
<dt>/capability/testQuery/pos/long</dt> <dd>The Right Ascension of the center of the search position in decimal degrees (ssap, sia).</dd>
<dt>/capability/testQuery/pos/refframe</dt> <dd>A coordinate system reference frame name for a test query. If not provided, ICRS is assumed (ssap).</dd>
<dt>/capability/testQuery/queryDataCmd</dt> <dd>Fully specified test query formatted as an URL argument list in the syntax specified by the SSA standard. The list must exclude the REQUEST argument (ssap).</dd>
<dt>/capability/testQuery/ra</dt> <dd>Right ascension in a test query (cs)</dd>
<dt>/capability/testQuery/size</dt> <dd>The size of the search radius in an SSA search query (ssap).</dd>
<dt>/capability/testQuery/size/lat</dt> <dd>Region size for a SIA test query in declination (sia).</dd>
<dt>/capability/testQuery/size/long</dt> <dd>Region size for a SIA test query in RA (sia).</dd>
<dt>/capability/testQuery/sr</dt> <dd>Search radius of a cone search service's test query (cs).</dd>
<dt>/capability/testQuery/verb</dt> <dd>Verbosity of a service's test query (cs, sia).</dd>
<dt>/capability/uploadLimit/default</dt> <dd>An advisory size above which user agents should reconfirm uploads to this service (tr).</dd>
<dt>/capability/uploadLimit/default/@unit</dt> <dd>The unit of the limit specified (tr).</dd>
<dt>/capability/uploadLimit/hard</dt> <dd>Hard limit for the size of uploads on this service (tr).</dd>
<dt>/capability/uploadLimit/hard/@unit</dt> <dd>The unit of the limit specified (tr).</dd>
<dt>/capability/uploadMethod/@ivo-id</dt> <dd>The IVORN of an upload method supported by the service (tr).</dd>
<dt>/capability/verbosity (!)</dt> <dd><code>true</code> if the service supports the VERB keyword; <code>false</code>, otherwise (cs).</dd>
<dt>/coverage/footprint (!)</dt> <dd>A URL of a footprint service for retrieving precise and up-to-date description of coverage (vs).</dd>
<dt>/coverage/footprint/@ivo-id (!)</dt> <dd>The URI form of the IVOA identifier for the service describing the capability refered to by this element (vs).</dd>
<dt>/deprecated (!)</dt> <dd>A sentinel that all versions of the referenced standard are deprectaed. The value is a human-readable explanation for the designation (vstd).</dd>
<dt>/endorsedVersion (!)</dt> <dd>A version of a standard that is recommended for use (vstd).</dd>
<dt>/facility (!)</dt> <dd>The observatory or facility used to collect the data contained or managed by this resource (vs).</dd>
<dt>/format (!)</dt> <dd>The physical or digital manifestation of the information supported by a (DataCollection) resource.  MIME types should be used for network-retrievable, digital data, non-MIME type values are used for media that cannot be retrieved over the network (vs).</dd>
<dt>/format/@isMIMEType</dt> <dd>If <code>true</code>, then an accompanying <code>/format</code> item is a MIME Type. Within res_details, this does not work for services that give more than one format; since furthermore the literal of vs:Format allows a good guess whether or not it is a MIME type, this does not appear a dramatic limitation (vs).</dd>
<dt>/full</dt> <dd>If true, the registry attempts to collect all resource records known to the IVOA (vg).</dd>
<dt>/instrument (!)</dt> <dd>The instrument used to collect the data contained or managed by a resource (vr).</dd>
<dt>/instrument/@ivo-id (!)</dt> <dd>IVORN of the instrument used to collect the data contained or managed by a resource (vr).</dd>
<dt>/managedAuthority (!)</dt> <dd>An authority identifier managed by a registry (vg).</dd>
<dt>/managingOrg (!)</dt> <dd>The organization that manages or owns this authority (vg).</dd>
<dt>/schema/@namespace (!)</dt> <dd>An identifier for a schema described by a standard (vstd).</dd>

</dl>

<p>Note that the representation of StandardsRegExt's 
<code>status</code>  and <code>use</code>
attributes as well as its <code>key</code> would require sequences of
complex objects, which is impossible using <code>res_detail</code>.
Hence, the respective metadata is not queriable
within the relational registry. Similarly, complex TAPRegExt metadata on
languages, user defined functions, and the like cannot be
represented in this table.  Since these pieces of metadata do not seem
relevant to resource discovery and are geared towards other uses of the
respective VOResource extensions, a more complex model does not seem
warrented just so they can be exposed.</p>
</div> <!-- section d_u_list -->

<div class="section"><h2><a id="appPGDefs"><span class="secnum">B. </span>The Extra UDFs in PL/pgSQL</a></h2>

<p>What follows are (non-normative) 
implementations of the three user defined functions
specificed in section <span class="xref"><a href="#adqludf">9</a></span> in the SQL dialect
of PostgreSQL (e.g., <cite>[<a href="#doc:Postgres92">doc:Postgres92</a>]</cite>).</p>

<p>Note that PostgreSQL cannot use fulltext indices on the respective
columns if the functions are defined in this way for (fairly subtle)
reasons connected with NULL value handling.  While workarounds are
conceivable, they come with potentially unwelcome side effects, at least
as of PostgreSQL 9.x.  It is therefore recommended to replace
expressions involving the functions given here with simple boolean
expressions in the ADQL translation layer whenever possible.</p>

<pre>
  CREATE OR REPLACE FUNCTION ivo_hasword(haystack TEXT, needle TEXT)
  RETURNS INTEGER AS $func$
    SELECT CASE WHEN to_tsvector($1) @@ plainto_tsquery($2) 
      THEN 1 
      ELSE 0 
    END
  $func$ LANGUAGE SQL;

  CREATE OR REPLACE FUNCTION ivo_hashlist_has(hashlist TEXT, item TEXT)
  RETURNS INTEGER AS $func$
    -- postgres can't RE-escape a user string; hence, we'll have
    -- to work on the hashlist (this assumes hashlist is already
    -- lowercased).
    SELECT CASE WHEN lower($2) = ANY(string_to_array($1, '#'))
      THEN 1 
      ELSE 0 
    END
  $func$ LANGUAGE SQL;

  CREATE OR REPLACE FUNCTION ivo_nocasematch(value TEXT, pattern TEXT)
  RETURNS INTEGER AS $func$
    SELECT CASE WHEN $1 ILIKE $2
      THEN 1 
      ELSE 0 
    END
  $func$ LANGUAGE SQL;
</pre>

</div> <!-- section appPGDefs -->

<div class="section"><h2><a id="appBP"><span class="secnum">C. </span>Implementation notes</a></h2>

<p>This appendix contains a set of constraints and recommendations for
implementing the relational registry model on actual RDBMSes, originating
partly from an analysis of the data content of the VO registry in February
2013, partly from a consideration of limits in various XML schema documents.
This concerns, in particular, minimum lengths for columns of type
adql:VARCHAR.  Implementations MUST NOT truncate strings of length equal
to or smaller than the minimal lengths given here; the limitations are
not, however, upper limits, and indeed, when choosing an implementation
strategy it is in general preferable to not impose artificial length
restrictions, in particular if no performance penalty is incurred.</p>

<p>These notes can also be useful with a view to preparing user interfaces for
the relational registry, since input forms and similar user interface
elements invariably have limited space; the limits here give reasonable
defaults for the amount of data that should minimally be manipulatable
by a user with reasonable effort.</p>

<p>The <code>ivoid</code> field present in every table of this
specification merits special consideration, on the one hand due to its
frequency, but also since other IVOA identifiers stored in the
relational registry should probably be treated analogously.
Given that IVORNs in the 2013 data fields have a maximum
length of roughly 100 characters, we propose that a maximum length of 
255 should be sufficient even when taking possible fragment identifiers
into account.</p>

<div class="tablewrap">
  <table class="results" frame="box" rules="rows">
    <thead>
      <tr>
        <th class="thVertical">Field type</th>
        <th class="thVertical">Datatype suggested</th>
        <th class="thVertical">Pertinent Fields</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>ivo-id</td>
        <td><code>VARCHAR(255)</code></td>
        <td>
          {all_tables}.ivoid<br/>
          res_role.role_ivoid<br/>
          capability.standard_id<br/>
          relationship.related_id<br/>
          validation.validated_by<br/>
          res_detail.detail_value for several values of detail_xpath
        </td>
      </tr>
    </tbody>
  </table>
</div>

<p>The relational registry also contains some date-time values. The most
straightforward implementation certainly is to use SQL timestamps.
Other relational registry fields that straightforwardly map to common
SQL types are those that require numeric values, viz.,
<code>REAL</code>, <code>SMALLINT</code>, and
<code>INTEGER</code>.  The following table summarizes these:</p>

<div class="tablewrap">
  <table class="results" frame="box" rules="rows">
    <thead>
      <tr>
        <th class="thVertical">Field type</th>
        <th class="thVertical">Datatype</th>
        <th class="thVertical">Pertinent Fields</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>floating point</td>
        <td><code>REAL</code></td>
        <td>resource.region_of_regard</td>
      </tr>
      <tr>
        <td>small integer</td>
        <td><code>SMALLINT</code></td>
        <td>table_column.std<br/>
          intf_param.std<br/>
          validation.level<br/>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<p>The fields containing Utypes, UCDs, and Units are treated in parallel
here. The 2013 registry data indicates a length of 128 characters is
sufficient for real-world purposes; actually, at least UCDs and Units
could of course grow without limitations, but it seems unreasonable
anything longer than a typical line might actually be useful.  As far as
utypes are concerned, we expect those to shrink rather than grow with
new standardization efforts.</p>

<p>In this category, we also summarize our resource xpaths.  With the
conventions laid down in this document, it seems unlikely that future
extensions to VOResource will be so deeply nested that 128 characters
will not be sufficient for their resource xpaths.</p>


<div class="tablewrap">
  <table class="results" frame="box" rules="rows">
    <thead>
      <tr>
        <th class="thVertical">Field type</th>
        <th class="thVertical">Datatype suggested</th>
        <th class="thVertical">Pertinent Fields</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Utype(s)<br/>UCD(s)<br/>Units<br/>xpaths</td>
        <td><code>VARCHAR(128)</code></td>
        <td>res_schema.schema_utype<br/>
          res_table.table_utype<br/>
          table_column.ucd<br/>
          table_column.unit<br/>
          table_column.utype<br/>
          intf_param.ucd<br/>
          intf_param.unit<br/>
          intf_param.utype<br/>
          res_detail.detail_xpath
        </td>
      </tr>
    </tbody>
  </table>
</div>

<p>The relational registry further has an
e-mail field, for which we chose 128 characters as a reasonable upper
limit (based on a real maximum of 40 characters in the 2013 data).
There are furthermore URLs (in addition to access and reference URLs,
there are also URLs for the WSDL of SOAP services and logos for roles).
Due to the importance of in particular the access URLs we strongly
recommend to use non-truncating types here.  Empirically, there are
access URLs of up to 224 characters in 2013 (reference URLs are less
critical at a maximum of 96 characters).  Expecting that with REST-based
services, URL lengths will probably rather tend down than up, we still
permit truncation at 255 characters.</p>

<div class="tablewrap">
  <table class="results" frame="box" rules="rows">
    <thead>
      <tr>
        <th class="thVertical">Field type</th>
        <th class="thVertical">Datatype suggested</th>
        <th class="thVertical">Pertinent Fields</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>e-mail</td>
        <td><code>VARCHAR(128)</code></td>
        <td>
          res_role.email<br/>
        </td>
      </tr>

      <tr>
        <td>URLs</td>
        <td><code>VARCHAR(255)</code></td>
        <td>resource.reference_url<br/>
          res_role.logo<br/>
          interface.wsdl_url<br/>
          interface.access_url
        </td>
      </tr>
    </tbody>
  </table>
</div>

<p>The next group of columns comprises those that have values taken from
a controlled or finite vocabulary.
Trying to simplify the view,
lengths in the form
of powers of two are considered.</p>

<div class="tablewrap">
  <table class="results" frame="box" rules="rows">
    <thead>
      <tr>
        <th class="thVertical">Field type</th>
        <th class="thVertical">Datatype suggested</th>
        <th class="thVertical">Pertinent Fields</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="4">predefined<br/>values</td>
        <td><code>VARCHAR(255)</code></td>
        <td>resource.content_level<br/>
          resource.content_type
        </td>
      </tr>
      <tr>
        <td><code>VARCHAR(64)</code></td>
        <td>
          resource.rights<br/>
          resource.waveband</td>
      </tr>
      <tr>
        <td><code>VARCHAR(32)</code></td>
        <td>resource.res_type<br/>
          capability.cap_type<br/>
          res_table.table_type<br/>
          table_column.flag<br/>
          table_column.datatype<br/>
          table_column.extended_schema<br/>
          table_column.extended_type<br/>
          table_column.type_system<br/>
          interface.result_type<br/>
          intf_param.datatype<br/>
          intf_param.extended_schema<br/>
          intf_param.extended_type<br/>
        </td>
      </tr>
      <tr>
        <td><code>VARCHAR(4)</code></td>
        <td>interface.query_type<br/>
          interface.url_use
        </td>
      </tr>
    </tbody>
  </table>
</div>
<p>Finally, there are the fields that actually contain what is
basically free text.
For these, we have made a choice from reasonable powers of two lengths 
considering the actual lengths in the 2013 registry data. 
A special case are fields that either contain natural language text (the
descriptions) or those that have grown without limit historically
(resource.creator_seq, and, giving in to current abuses discussed above,
res_role.role_name).  For all such fields, no upper limit can sensibly
be defined.  However, since certain DBMSes (e.g., MySQL older than
version 5.6) cannot index fields with a TEXT datatype and thus using
VARCHAR may be necessary at least for frequenly-searched fields, we give
the maximal length of the fields in the 2013 registry in parentheses after
the column designations for the TEXT datatype:</p>

<div class="tablewrap">
  <table class="results" frame="box" rules="rows">
    <thead>
      <tr>
        <th class="thVertical">Field type</th>
        <th class="thVertical">Datatype suggested</th>
        <th class="thVertical">Interested Fields</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="6">free string values</td>
        <td><code>TEXT</code></td>
        <td>resource.res_description (7801)<br/>
          resource.creator_seq (712)<br/>
          res_role.role_name (712)<br/>
          res_schema.schema_description (934)<br/>
          res_table.table_description (934)<br/>
          table_column.description (3735)<br/>
          intf_param.description (347)
          capability.cap_description (100)<br/>
        </td>
      </tr><tr>
        <td><code>VARCHAR(255)</code></td>
        <td>resource.res_title<br/>
          res_role.address<br/>
          res_schema.schema_title<br/>
          res_table.table_title<br/>
          relationship.related_name<br/>
          res_detail.detail_value
        </td>
      </tr><tr>
        <td><code>VARCHAR(128)</code></td>
        <td>resource.version<br/>
          resource.source_value<br/>
          res_subject.res_subject<br/>
        </td>
      </tr><tr>
        <td><code>VARCHAR(64)</code></td>
        <td>res_table.table_name<br/>
          table_column.name<br/>
          intf_param.name
        </td>
      </tr><tr>
        <td><code>VARCHAR(32)</code></td>
        <td>resource.source_format<br/>
          res_role.telephone<br/>
          res_schema.schema_name<br/>
          interface.intf_type<br/>
          interface.intf_role<br/>
          relationship_type<br/>
          res_date.value_role
        </td>
      </tr><tr>
        <td><code>VARCHAR(16)</code></td>
        <td>resource.short_name<br/>
          table_column.arraysize<br/>
          intf_param.arraysize<br/>
          interface.std_version<br/>
          intf_param.use
        </td>
      </tr>
    </tbody>
  </table>
</div>

</div>  <!-- section appBD - RDB impl.notes-->

<div class="section"><h2><a id="appMkut"><span class="secnum">D. </span>XSLT to enumerate Relational Registry XPaths</a></h2>

<p>The (non-normative) following XSL stylesheet emits xpaths as
discussed in section <span class="xref"><a href="#vorutypes">6</a></span> when applied to a
VOResource extension.  Considering readability and limitations of XSLT, this is
not fully general -- if VOResource extensions started to inherit from other
extensions' subclasses of Resource, Capability, or Interface, this stylesheet
will need to be extended.</p>

<p>Still, it is a useful tool when evaluating how to map a given extension
to the relational registry.</p>

<div><!--The contents of this div are automatically generated from the following processing instruction when processed with ivoarestructure.xsl-->
    <?incxml href="../makeutypes.xslt" ?><h:div xmlns:h="http://www.w3.org/1999/xhtml" class="viewxml"><div class="element"><span class="markup">&lt;</span><span class="start-tag">stylesheet</span> <span class="attribute-name">version</span><span class="markup">=</span><span class="attribute-value">"1.0"</span> <span class="attribute-name">xmlns:xml</span><span class="markup">=</span><span class="attribute-value">"http://www.w3.org/XML/1998/namespace"</span> <span class="attribute-name">xmlns:</span><span class="markup">=</span><span class="attribute-value">"http://www.w3.org/1999/XSL/Transform"</span> <span class="attribute-name">xmlns:xs</span><span class="markup">=</span><span class="attribute-value">"http://www.w3.org/2001/XMLSchema"</span> <span class="attribute-name">xmlns:vr</span><span class="markup">=</span><span class="attribute-value">"http://www.ivoa.net/xml/VOResource/v1.0"</span> <span class="attribute-name">xmlns:vs</span><span class="markup">=</span><span class="attribute-value">"http://www.ivoa.net/xml/VODataService/v1.1"</span><span class="markup">&gt;</span><div class="indent"><div class="comment">&lt;!-- extract RegTAP xpath from VOResource and related XML schema files --&gt;</div><div class="comment">&lt;!--
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    For the complete text of the GPL, see http://www.gnu.org/licenses/.
--&gt;</div><div class="comment">&lt;!-- The basic strategy here is: start from all discernible types
derived from vr:Resource, vr:Capability, and vr:Interface; we need to
handle capability and interface separately since they may not be
explicitely reachable from a resource due to the way capability and
interface types are declared in VOResource (i.e., through xsi:type).

Each root is the start element for a recursion yielding the utypes.
During this recursion, attributes yield utypes by concatenating the
parent name with the attribute name, and elements yield utypes by
concatenating the element name with the parent name.  Elements take part
in the recursion, where their utype becomes the new parent name.

Note that the xpaths generated here are the ones used in the 
res_details table.  For the xpaths used in lieu of utypes in
TAP_SCHEMA and VOSI tables, you'll want to make them relative.

Hack alert: We need to traverse the type tree; however, due to 
(practical) limitations of XSLT1, we don't do that across files.  So,
if a type were to inherit from a class derived from VOResource or Capability
in another document, this stylesheet would not notice.  Also, we kill all
namespace prefixes in attributes.  Proper handling of that probably is
close to impossible with XSLT1.  --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">output</span> <span class="attribute-name">method</span><span class="markup">=</span><span class="attribute-value">"text"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">strip-space</span> <span class="attribute-name">elements</span><span class="markup">=</span><span class="attribute-value">"*"</span><span class="markup">/&gt;</span></div><div class="comment">&lt;!-- An index used to retrieve the type definitions for the child
elements in walk; note that this only spans one file,
which is the primary limitation of this program --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">key</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"definitions"</span> <span class="attribute-name">match</span><span class="markup">=</span><span class="attribute-value">"xs:simpleType|xs:complexType"</span> <span class="attribute-name">use</span><span class="markup">=</span><span class="attribute-value">"@name"</span><span class="markup">/&gt;</span></div><div class="comment">&lt;!-- A map from types to the names of their base classes; this is
a bit haphazard since we don't want to use XSLT extensions that
actually understand XML schema.  A recursion within the type
hierarchy takes place in walk-for-type --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">key</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"of-type"</span> <span class="attribute-name">match</span><span class="markup">=</span><span class="attribute-value">"xs:complexType"</span> <span class="attribute-name">use</span><span class="markup">=</span><span class="attribute-value">"substring-after(./xs:complexContent/*/@base, ':')"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"add-doc"</span><span class="markup">&gt;</span><div class="indent"><div class="comment">&lt;!-- retrieve the "short" doc and add them in parens if present,
  emit an lf either way --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">if</span> <span class="attribute-name">test</span><span class="markup">=</span><span class="attribute-value">"boolean(xs:annotation[1])"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">value-of</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"concat(' (', normalize-space(xs:annotation[1]/xs:documentation), ')')"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">if</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">text</span><span class="markup">&gt;</span><span class="text">
</span><span class="markup">&lt;/</span><span class="end-tag">text</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk"</span><span class="markup">&gt;</span><div class="indent"><div class="comment">&lt;!-- the central (recursive) template building up utypes by
	collecting subelements; the current node here is a type definition --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">for-each</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"descendant::xs:attribute"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">value-of</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"concat($parent-path, '/@', @name)"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"add-doc"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">for-each</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">for-each</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"descendant::xs:element"</span><span class="markup">&gt;</span><div class="indent"><div class="comment">&lt;!-- capability and interface are roots of their own --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">if</span> <span class="attribute-name">test</span><span class="markup">=</span><span class="attribute-value">"@name!='capability' and @name!='interface'"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">value-of</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"concat($parent-path, '/', @name)"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"add-doc"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">variable</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"child-type"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"substring-after(@type, ':')"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">if</span> <span class="attribute-name">test</span><span class="markup">=</span><span class="attribute-value">"key('definitions', $child-type)"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">variable</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"child-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"concat($parent-path, '/', @name)"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">for-each</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"key('definitions', $child-type)"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"$child-path"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">for-each</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">if</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">if</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">for-each</span><span class="markup">&gt;</span></div><div class="comment">&lt;!-- collect attributes and elements for our node from the types
  we are derived from, too --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">for-each</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"descendant::xs:extension|descendant::xs:restriction"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">for-each</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"key('definitions', substring-after(@base, ':'))"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"$parent-path"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">for-each</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">for-each</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk-for-type"</span><span class="markup">&gt;</span><div class="indent"><div class="comment">&lt;!-- iterates over the types and elements derived from base-type --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"base-type"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">for-each</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"key('of-type', $base-type)"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"$parent-path"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk-for-type"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"base-type"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"@name"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"$parent-path"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">for-each</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">template</span><span class="markup">&gt;</span></div><div class="comment">&lt;!-- templates cover the immediate types; the derived types are handled
in explicit call-templates in the the template for root below. --&gt;</div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">match</span><span class="markup">=</span><span class="attribute-value">"//xs:complexType[@name='Resource']"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'Resource'"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">match</span><span class="markup">=</span><span class="attribute-value">"//xs:complexType[@name='Capability']"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'Capability'"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">match</span><span class="markup">=</span><span class="attribute-value">"//xs:complexType[@name='Interface']"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'Interface'"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">match</span><span class="markup">=</span><span class="attribute-value">"/"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">apply-templates</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk-for-type"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"base-type"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'Resource'"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"''"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk-for-type"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"base-type"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'Service'"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"''"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk-for-type"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"base-type"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'Capability'"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'/capability'"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">call-template</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"walk-for-type"</span><span class="markup">&gt;</span><div class="indent"><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"base-type"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'Interface'"</span><span class="markup">/&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">with-param</span> <span class="attribute-name">name</span><span class="markup">=</span><span class="attribute-value">"parent-path"</span> <span class="attribute-name">select</span><span class="markup">=</span><span class="attribute-value">"'/capability/interface'"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">call-template</span><span class="markup">&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">template</span><span class="markup">&gt;</span></div><div class="element"><span class="markup">&lt;</span><span class="start-tag">template</span> <span class="attribute-name">match</span><span class="markup">=</span><span class="attribute-value">"text()"</span><span class="markup">/&gt;</span></div></div><span class="markup">&lt;/</span><span class="end-tag">stylesheet</span><span class="markup">&gt;</span></div><div class="comment">&lt;!-- vi:et:sw=2:sta
--&gt;</div></h:div>
    <!--end of autogenerated content--></div>

</div> <!-- section appMkut -->

<div class="section"><h2><a id="changes"><span class="secnum">E. </span>Changes from Previous Versions</a></h2>

<div class="section"><h3><a id="changes-20140227"><span class="secnum">E.1. </span>Changes from PR-20140227</a></h3>

<ul>
  <li>Added a <code>/full</code> details xpath from VORegistry (this had
  been forgotten due to limitations in the makeutypes stylesheet).</li>
  <li>Added a <code>/capability/interface/securityMethod/@standardID</code>
  details xpath from vr:Interface.</li>
  <li>New rules on string normalization: strings must be
  whitespace-stripped, empty strings must be mapped to NULL.</li>
  <li>Dropped requirements that the <code>_index</code> columns are
  integers (let alone small integers); added a section discussing in
  what sense they are implementation defined.</li>
  <li>Now declaring a precedence of xpaths generated by rules over the
  list in Appendix <span class="xref"><a href="#d_u_list">A</a></span></li>
  <li>Clarified translation of column/@std and param/@std</li>
  <li>Now recommending to contrain on <code>intf_type</code>
  (rather than <code>intf_role</code>, as before) when locating standard
  interfaces.</li>
  <li>Redactional changes from RFC (e.g., in column descriptions, some 
  clarifications, typo fixes)</li>
</ul>
</div> <!-- section changes-20140227 -->

<div class="section"><h3><a id="changes-20131203"><span class="secnum">E.2. </span>Changes from WD-20131203</a></h3>

<ul>
  <li>Changed the data model identifier to
  <code>ivo://ivoa.net/std/RegTAP#1.0</code> to match usage with a
  later standards record.</li>
  <li>Fixed a typo in a column name: schema.schemaname is now schema.schema_name
  as in the prose.</li>
  <li>Recovered 
  <code>/capability/uploadMethod/@ivo-id</code> res_detail keys that was
  accidentally lost in a previous version.</li>

  <li>Clarification of nomenclature.</li>
</ul>
</div> <!-- section changes-20131203 -->

<div class="section"><h3><a id="changes-20130909"><span class="secnum">E.3. </span>Changes from WD-20130909</a></h3>

<ul>
  <li>Updates for REC of SimpleDALRegExt, which contains versions 1.1 of
  both the sia and the ssap XML schemas; thisi means there are now additional
  namespace URIs to take into accound, as well as new res_detail xpaths
  <code>/capability/maxSearchRadius</code>, 
  <code>/capability/maxImageSize</code>, and 
  <code>/testQuery/pos/refframe</code>.</li>
  <li>Reinstated makeutypes.xslt script; it's useful even with the new
  xpaths.</li>
</ul>
</div> <!-- section changes-20130909 -->

<div class="section"><h3><a id="changes-20130411"><span class="secnum">E.4. </span>Changes from WD-20130411</a></h3>

<ul>
  <li>The final utype reform: most of our ex-utype strings aren't called utypes
  any more, they're fairly plain xpaths.  Consequently, 
  <code>res_detail.detail_utype</code> has been renamed 
  <code>res_detail.detail_xpath</code>.</li>
  <li>Renamed some columns and the subject table to relieve the need of quoting
  in MS SQL Server (or, in the case or <code>use_param</code>, maintain
  consistency after the renaming):<br/>
    <table>
      <tr><th>Old</th><th>New</th></tr>
      <tr><td>resource.version</td><td>resource.res_version</td></tr>
      <tr><td>res_role.address</td><td>res_role.street_address</td></tr>
      <tr><td>subject.*</td><td>res_subject.*</td></tr>
      <tr><td>res_subject.res_subject</td><td>res_subject.res_subject</td></tr>
      <tr><td>table_column.description</td><td>table_column.column_description</td></tr>
      <tr><td>intf_param.description</td><td>intf_param.param_description</td></tr>
      <tr><td>intf_param.use_param</td><td>intf_param.param_use</td></tr>
      <tr><td>validation.level</td><td>validation.val_level</td></tr>
    </table>
  </li>
  <li>rr.intf_param grew the arraysize and delim columns that before
    accidentally were only present in rr.table_column.</li>
  <li>Added warnings about having to match case-insensitively in
  res_detail.detail_value for IVORN-valued rows.</li>
  <li>Restored the foreign key from interface to capability.  Mandating
  ignoring interface elements from StandardsRegExt records really is the
  lesser evil.</li>
  <li><code>resource.region_of_regard</code> now must have unit metadata
  declared.</li>
  <li>We now explicitely deprecate multiple access urls per interface
  and announce that single access URLs will be enforced in future
  VOResource versions.</li>
</ul>

</div> <!-- subsection changes-20130411 -->


<div class="section"><h3><a id="changes-20130305" shape="rect"><span class="secnum">E.5. </span>Changes from WD-20130305</a></h3>

<ul>
<li>intf_index is now required to be unique within a resource, not a
capability; this is because StandardsRegExt has interfaces outside
of capabilities.  In consequence, the intf_param no longer has a
cap_index column, and its foreign key is just ivoid and intf_index.</li>
<li>Added handling for the StandardsRegExt schema element.</li>
<li>The list of res_details utypes was moved to an appendix since
it was too long to be included in the running text.</li>
<li>Redation for WD publication.</li>
</ul>
</div>

<div class="section"><h3><a id="changes-20121112" shape="rect"><span class="secnum">E.6. </span>Changes from WD-20121112</a></h3>

<ul>
<li>Adapted all utypes to better match future VO-DML utypes.</li>
<li>footprint, data_url, facility, and instrument are no longer in rr.resource
but are instead kept in rr.res_details rows.</li>
<li>For VOResource compliance, intf_param has no flag column any more.</li>
<li>res_role.base_utype is renamed to res_role.base_role and no longer
pretends to be a utype fragments; also, the content is now a simple
word..</li>
<li>intf_param.use is now called intf_param.use_param to avoid possible
clashes with reserved SQL words.</li>
<li>Removed all material on STC coverage.</li>
<li>Added an appendix recommending field sizes.</li>
</ul>
</div><!-- changes-20121112 -->
</div><!-- changes -->

</div> <!-- appendices -->

<div class="section-nonum"><h2><a id="references"><span class="secnum"/>References</a></h2>

<?bibliography ivoadoc/refs?><dl>

<dt><a name="std:RI1">[std:RI1] Kevin Benson, Ray Plante, Elizabeth Auden,
  Matthew Graham, Gretchen Greene, Martin Hill, Tony Linde, Dave Morris, Wil
  O'Mullane, Guy Rixon, Aurélien Stébé, and Kona Andrews, Kevin Benson and
  Ray Plante, editors.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/RegistryInterface/">IVOA registry
  interfaces version 1.0</a>.
  IVOA Recommendation, 2009.
</dd>

<dt><a name="std:RFC2119">[std:RFC2119] S Bradner.</a></dt> <dd>
  <a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to
  indicate requirement levels</a>.
  RFC 2119, March 1997.
</dd>

<dt><a name="std:XMLNS">[std:XMLNS] Tim Bray, Dave Hollander, Andrew Layman,
  Richard Tobin, and Henry S. Thompson.</a></dt> <dd>
  <a href="http://www.w3.org/TR/2009/REC-xml-names-20091208/">Namespaces in
  XML 1.0 (third edition)</a>.
  W3C Recommendation, December 2009.
</dd>

<dt><a name="std:XPATH">[std:XPATH] James Clark and Steve DeRose.</a></dt> <dd>
  <a href="http://www.w3.org/TR/1999/REC-xpath-19991116">Xml path language
  (xpath), version 1.0</a>.
  W3C Recommendation, 1999.
</dd>

<dt><a name="std:UNICODE">[std:UNICODE] The Unicode Consortium.</a></dt> <dd>
  <a href="http://www.unicode.org/versions/Unicode6.1.0">The unicode standard,
  version 6.1 core specification</a>, 2012.
</dd>

<dt><a name="std:TAPREGEXT">[std:TAPREGEXT] Markus Demleitner, Patrick Dowler,
  Ray Plante, Guy Rixon, and Mark Taylor.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/TAPRegExt">TAPRegExt: a
  VOResource schema extension for describing TAP services, version 1.0</a>.
  IVOA Recommendation, August 2012.
</dd>

<dt><a name="std:TAP">[std:TAP] Patrick Dowler, Guy Rixon, and Doug
  Tody.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/TAP">Table access protocol version
  1.0</a>.
  IVOA Recommendation, March 2010.
</dd>

<dt><a name="std:RM">[std:RM] Robert Hanisch, IVOA Resource Registry Working
  Group, and NVO Metadata Working Group, R Hanisch, editor.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/latest/RM.html">Resource metadata for
  the virtual observatory</a>.
  IVOA Recommendation, 2007.
</dd>

<dt><a name="std:STDREGEXT">[std:STDREGEXT] Paul Harrison, Douglas Burke, Ray
  Plante, Guy Rixon, and Dave Morris.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/StandardsRegExt/20120508/REC-StandardsRegExt-1.0-20120508.html">StandardsRegExt: a VOResource schema extension for describing IVOA
  standards, version 1.0</a>.
  IVOA Recommendation, May 2012.
</dd>

<dt><a name="doc:Postgres92">[doc:Postgres92]
  http://www.postgresql.org/docs/9.2/static/index.html.</a></dt> <dd>
  <a href="http://www.postgresql.org/docs/9.2/static/index.html">PostgreSQL
  9.2.1 documentation</a>.
  [Online].
</dd>

<dt><a name="std:OBSCORE">[std:OBSCORE] Mireille Louys, Francois Bonnarel,
  David Schade, Patrick Dowler, Alberto Micol, Daniel Durand, Doug Tody,
  Laurent Michel, Jesus Salgado, Igor Chilingarian, Bruno Rino, Juan
  de Dios Santander, and Petr Skoda, Doug Tody, Alberto Micol, Daniel Durand,
  and Mireille Louys, editors.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/ObsCore/20111028/REC-ObsCore-v1.0-20111028.pdf">Observation data model core components and its implementation in the Table
  Access Protocol, version 1.0</a>.
  IVOA Recommendation, 2011.
</dd>

<dt><a name="std:ADQL">[std:ADQL] Iñaki Ortiz, Jeff Lusted, Pat Dowler,
  Alexander Szalay, Yuji Shirasaki, Maria A. Nieto-Santisteba, Masatoshi
  Ohishi, William O'Mullane, Pedro Osuna, the VOQL-TEG, and the VOQL
  Working Group, Pedro Osuna and Iñaki Ortiz, editors.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/latest/ADQL.html">IVOA astronomical
  data query language</a>.
  IVOA Recommendation, 2008.
</dd>

<dt><a name="std:VOR">[std:VOR] Raymond Plante, Kevin Benson, Matthew Graham,
  Gretchen Greene, Paul Harrison, Gerard Lemson, Tony Linde, Guy Rixon, and
  Aurélien Stébé.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/REC/ReR/VOResource-20080222.html">VOResource: an XML encoding schema for resource metadata version
  1.03</a>.
  IVOA Recommendation, February 2008.
</dd>

<dt><a name="std:DALREGEXT">[std:DALREGEXT] Raymond Plante, Jesus Delago, Paul
  Harrison, and Doug Tody.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/SimpleDALRegExt/20120517/PR-SimpleDALRegExt-20120517.html">SimpleDALRegExt: Describing simple data access services, version 1.0</a>.
  IVOA Proposed Recommendation, May 2012.
</dd>

<dt><a name="std:VOID">[std:VOID] Raymond Plante, Tony Linde, Roy Williams, and
  Keith Noddle.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/REC/Identifiers/Identifiers-20070302.html">IVOA identifiers, version 1.03</a>.
  IVOA Recommendation, March 2007.
</dd>

<dt><a name="std:VODS11">[std:VODS11] Raymond Plante, Aurélien Stébé, Kevin
  Benson, Patrick Dowler, Matthew Graham, Gretchen Greene, Paul Harrison,
  Gerard Lemson, Tony Linde, and Guy Rixon.</a></dt> <dd>
  <a href="http://www.ivoa.net/Documents/VODataService/">VODataService: a
  VOResource schema extension for describing collections and services version
  1.1</a>.
  IVOA Recommendation, December 2010.
</dd>

</dl>

</div> <!-- section references -->

</body></html><!-- vi: sw=2:et:sta
-->